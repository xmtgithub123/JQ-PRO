#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/user/SetAvatar.cshtml")]
    public partial class _Views_user_SetAvatar_cshtml : System.Web.Mvc.WebViewPage<dynamic>
    {
        public _Views_user_SetAvatar_cshtml()
        {
        }
        public override void Execute()
        {
WriteLiteral("<script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(@">
    $(function () {
        JQ.form.submitInit({
            formid: ""useravatar"",
            buttonTypes: [""close""],
            succesCollBack: function (data) {


            },
            beforeButtons: [
                {
                    icon: ""fa-check"", text: ""确定"", onClick: function () {
                        if (!filename || !_imgAreaSelect) {
                            JQ.dialog.info(""请选择一张图片做为头像！"");
                            return;
                        }
                        window.top.$.messager.progress();
                        $.ajax({
                            url: """);

            
            #line 19 "..\..\Views\user\SetAvatar.cshtml"
                              Write(Url.Action("ChangeAvatar", "user",new { @area="Core" }));

            
            #line default
            #line hidden
WriteLiteral(@""",
                            type: ""post"",
                            data: { x1: x1, y1: y1, x2: x2, y2: y2, imgHeight: imgHeight, imgWidth: imgWidth, fileName: filename },
                            success: function (result) {
                                window.top.$.messager.progress(""close"");
                                if (result.Result == false) {
                                    alert(result.Message);
                                    return;
                                }
                                window.top.document.getElementById(""");

            
            #line 28 "..\..\Views\user\SetAvatar.cshtml"
                                                                Write(Request.QueryString["parentID"]);

            
            #line default
            #line hidden
WriteLiteral(@""").contentWindow.reloadAvatar();
                                JQ.dialog.dialogClose();
                            }
                        });
                    }
                }
            ],
            buttons: [
                {
                    icon: ""fa-upload"", text: ""上传图片"", onClick: function () {
                        uploadimg();
                    }
                }
            ]
        });
    });
</script>
<form");

WriteLiteral(" id=\"useravatar\"");

WriteLiteral(" name=\"useravatar\"");

WriteLiteral(">\r\n    <input");

WriteLiteral(" type=\"button\"");

WriteLiteral(" id=\"btnUploadImage\"");

WriteLiteral(" style=\"display:none\"");

WriteLiteral(" />\r\n    <div");

WriteLiteral(" id=\"divContainer\"");

WriteLiteral(" style=\"width:500px;height:400px;float:left;background-color:#DFDFDF;color:#FFFFF" +
"F;line-height:400px;text-align:center;font-size:20px;position:relative;overflow:" +
"hidden\"");

WriteLiteral("></div>\r\n    <div");

WriteLiteral(" style=\"float:left;padding:0px 10px 0px 10px;color:#444444\"");

WriteLiteral(">\r\n        <div");

WriteLiteral(" style=\"margin-top:5px;cursor:default;-webkit-user-select:none\"");

WriteLiteral(">头像预览</div>\r\n        <div");

WriteLiteral(" id=\"div1\"");

WriteLiteral(" style=\"position:relative;height:128px;width:128px;border:1px solid #666666;margi" +
"n-top:10px;background-color:#DFDFDF;overflow:hidden\"");

WriteLiteral("></div>\r\n        <div>128*128</div>\r\n        <div");

WriteLiteral(" id=\"div2\"");

WriteLiteral(" style=\"position:relative;height:64px;width:64px;border:1px solid #666666;margin-" +
"top:20px;background-color:#DFDFDF;overflow:hidden\"");

WriteLiteral("></div>\r\n        <div>64*64</div>\r\n    </div>\r\n</form>\r\n<script");

WriteLiteral(" type=\"text/javascript\"");

WriteAttribute("src", Tuple.Create(" src=\"", 2696), Tuple.Create("\"", 2748)
            
            #line 56 "..\..\Views\user\SetAvatar.cshtml"
, Tuple.Create(Tuple.Create("", 2702), Tuple.Create<System.Object, System.Int32>(Url.Content("~/Scripts/uploader/upload.js")
            
            #line default
            #line hidden
, 2702), false)
);

WriteLiteral("></script>\r\n<link");

WriteAttribute("href", Tuple.Create(" href=\"", 2766), Tuple.Create("\"", 2844)
            
            #line 57 "..\..\Views\user\SetAvatar.cshtml"
, Tuple.Create(Tuple.Create("", 2773), Tuple.Create<System.Object, System.Int32>(Url.Content("~/Scripts/imgareaselect/css/imgareaselect-default.css")
            
            #line default
            #line hidden
, 2773), false)
);

WriteLiteral(" rel=\"stylesheet\"");

WriteLiteral(" />\r\n<script");

WriteLiteral(" type=\"text/javascript\"");

WriteAttribute("src", Tuple.Create(" src=\"", 2897), Tuple.Create("\"", 2973)
            
            #line 58 "..\..\Views\user\SetAvatar.cshtml"
, Tuple.Create(Tuple.Create("", 2903), Tuple.Create<System.Object, System.Int32>(Url.Content("~/Scripts/imgareaselect/jquery.imgareaselect.pack.js")
            
            #line default
            #line hidden
, 2903), false)
);

WriteLiteral("></script>\r\n<script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(@">
    var _divContainer = document.getElementById(""divContainer"");
    var _imgAreaSelect = null, image1 = null, image2 = null, imgHeight = 0, imgWidth = 0, filename;
    var x1 = 0, y1 = 0, x2 = 0, y2 = 0;
    var uploader = new plupload.Uploader({
        runtimes: ""html5,flash,html4,silverlight"",
        browse_button: ""btnUploadImage"",
        chunk_size: ""1mb"",
        url: """);

            
            #line 67 "..\..\Views\user\SetAvatar.cshtml"
          Write(Url.Action("Upload", "ProcessFile", new { @area = "Core" }));

            
            #line default
            #line hidden
WriteLiteral("\",\r\n        flash_swf_url: \"");

            
            #line 68 "..\..\Views\user\SetAvatar.cshtml"
                    Write(Url.Content("~/Scripts/uploader/upload.swf"));

            
            #line default
            #line hidden
WriteLiteral("\",\r\n        silverlight_xap_url: \"");

            
            #line 69 "..\..\Views\user\SetAvatar.cshtml"
                          Write(Url.Content("~/Scripts/uploader/upload.xap"));

            
            #line default
            #line hidden
WriteLiteral(@""",
        multi_selection: false,
        filters: {
            max_file_size: ""1gb"",
            mime_types: [
                    { title: ""Image files"", extensions: ""jpg,png,bmp,jpeg"" },
            ]
        },
        init: {
            BeforeUpload: function (up, file) {
                $(""#"" + file.uploaderName + ""_toggle"").linkbutton(""disable"");
                up.settings.multipart_params = {
                    refID: 0,
                    refTable: ""UserAvatar"",
                    fileID: file.id
                }
            },
            FilesAdded: function (up, files) {
                up.start();
            },
            UploadProgress: function (up, file) {
                _divContainer.innerHTML = """";
                _divContainer.appendChild(document.createTextNode(file.percent + ""%""));
            },
            FileUploaded: function (up, file, info) {
                info = JQ.Flow.parseJson(info.response);
                if (_imgAreaSelect) {
                    _imgAreaSelect.remove();
                }
                filename = info.Name;
                var url = """);

            
            #line 99 "..\..\Views\user\SetAvatar.cshtml"
                       Write(Url.Action("Download", "ProcessFile", new { @area = "Core" }));

            
            #line default
            #line hidden
WriteLiteral("?id=0&name=\" + info.Name + \"&realName=\" + new Date().valueOf();\r\n                " +
"image1 = setImage(\"div1\", url);\r\n                image2 = setImage(\"div2\", url);" +
"\r\n                var image = document.createElement(\"img\");\r\n                im" +
"age.setAttribute(\"src\", url);\r\n                _divContainer.innerHTML = \"\";\r\n  " +
"              image.style.position = \"absolute\";\r\n                image.onload =" +
" function () {\r\n                    var maxHeight = 400, maxWidth = 500;\r\n      " +
"              imgHeight = image.clientHeight;\r\n                    imgWidth = im" +
"age.clientWidth;\r\n                    var scale = maxHeight / maxWidth;\r\n       " +
"             if (imgHeight > maxHeight || imgWidth > maxWidth) {\r\n              " +
"          if (imgWidth * scale > imgHeight) {\r\n                            //以宽度" +
"为准\r\n                            imgHeight = imgHeight * (500 / imgWidth);\r\n     " +
"                       image.style.top = (400 - imgHeight) / 2 + \"px\";\r\n        " +
"                    image.style.left = \"0px\";\r\n                            image" +
".style.width = \"500px\";\r\n                            imgWidth = 500;\r\n          " +
"              }\r\n                        else {\r\n                            //以" +
"高度为准\r\n                            imgWidth = imgWidth * (400 / imgHeight);\r\n    " +
"                        image.style.height = \"400px\";\r\n                         " +
"   image.style.width = imgWidth + \"px\";\r\n                            image.style" +
".top = \"0px\";\r\n                            image.style.left = (500 - imgWidth) /" +
" 2 + \"px\";\r\n                            imgHeight = 400;\r\n                      " +
"  }\r\n                    }\r\n                    else {\r\n                        " +
"image.style.top = (400 - imgHeight) / 2 + \"px\";\r\n                        image.s" +
"tyle.left = (500 - imgWidth) / 2 + \"px\";\r\n                    }\r\n               " +
"     image1.style.width = imgWidth + \"px\";\r\n                    image1.style.hei" +
"ght = imgHeight + \"px\";\r\n                    image2.style.width = imgWidth + \"px" +
"\";\r\n                    image2.style.height = imgHeight + \"px\";\r\n               " +
"     debugger;\r\n                    x1 = 0; y1 = 0; x2 = 0; y2 = 0;\r\n           " +
"         if (imgHeight > imgWidth) {\r\n                        if (imgWidth >= 25" +
"6) {\r\n                            x1 = (imgWidth - 256) / 2;\r\n                  " +
"          x2 = x1 + 256;\r\n                            y1 = (imgHeight - 256) / 2" +
";\r\n                            y2 = y1 + 256;\r\n                        }\r\n      " +
"                  else {\r\n                            x1 = 0;\r\n                 " +
"           x2 = imgWidth;\r\n                            if (imgHeight >= 256) {\r\n" +
"                                y1 = (imgHeight - 256) / 2;\r\n                   " +
"             y2 = y1 + imgWidth;\r\n                            }\r\n               " +
"             else {\r\n                                y1 = 0;\r\n                  " +
"              y2 = imgWidth;\r\n                            }\r\n                   " +
"     }\r\n                    }\r\n                    else {\r\n                     " +
"   if (imgHeight >= 256) {\r\n                            x1 = (imgWidth - 256) / " +
"2;\r\n                            x2 = x1 + 256;\r\n                            y1 =" +
" (imgHeight - 256) / 2;\r\n                            y2 = y1 + 256;\r\n           " +
"             }\r\n                        else {\r\n                            y1 =" +
" 0;\r\n                            y2 = imgHeight;\r\n                            if" +
" (imgWidth >= 256) {\r\n                                x1 = (imgWidth - 256) / 2;" +
"\r\n                                x2 = x1 + y2;\r\n                            }\r\n" +
"                            else {\r\n                                x1 = 0;\r\n   " +
"                             x2 = imgWidth;\r\n                            }\r\n    " +
"                    }\r\n                    }\r\n                    _imgAreaSelect" +
" = $(this).imgAreaSelect({\r\n                        handles: true,\r\n            " +
"            aspectRatio: \"1:1\",\r\n                        maxHeight: 256,\r\n      " +
"                  maxWidth: 256,\r\n                        onSelectChange: previe" +
"w,\r\n                        x1: x1,\r\n                        y1: y1,\r\n          " +
"              x2: x2,\r\n                        y2: y2,\r\n                        " +
"keys: true,\r\n                        instance: true,\r\n                        pe" +
"rsistent: true,\r\n                        onSelectEnd: function (img, selection) " +
"{\r\n                            x1 = selection.x1;\r\n                            x" +
"2 = selection.x2;\r\n                            y1 = selection.y1;\r\n             " +
"               y2 = selection.y2;\r\n                        }\r\n                  " +
"  });\r\n                    preview(null, { x1: x1, y1: y1, width: x2 - x1, heigh" +
"t: y2 - y1 });\r\n                }\r\n                _divContainer.appendChild(ima" +
"ge);\r\n            }\r\n        },\r\n    });\r\n    uploader.init();\r\n    function upl" +
"oadimg() {\r\n        document.getElementById(\"btnUploadImage\").click();\r\n    }\r\n\r" +
"\n    function preview(img, selection) {\r\n        if (image1) {\r\n            var " +
"scaleX = 128 / (selection.width || 1);\r\n            var scaleY = 128 / (selectio" +
"n.height || 1);\r\n            image1.style.width = Math.round(scaleX * imgWidth) " +
"+ \"px\";\r\n            image1.style.height = Math.round(scaleY * imgHeight) + \"px\"" +
";\r\n            image1.style.marginLeft = \"-\" + Math.round(scaleX * selection.x1)" +
" + \"px\";\r\n            image1.style.marginTop = \"-\" + Math.round(scaleY * selecti" +
"on.y1) + \"px\";\r\n        }\r\n        if (image2) {\r\n            var scaleX = 64 / " +
"(selection.width || 1);\r\n            var scaleY = 64 / (selection.height || 1);\r" +
"\n            image2.style.width = Math.round(scaleX * imgWidth) + \"px\";\r\n       " +
"     image2.style.height = Math.round(scaleX * imgHeight) + \"px\";\r\n            i" +
"mage2.style.marginLeft = \"-\" + Math.round(scaleX * selection.x1) + \"px\";\r\n      " +
"      image2.style.marginTop = \"-\" + Math.round(scaleY * selection.y1) + \"px\";\r\n" +
"        }\r\n    }\r\n\r\n    function setImage(divID, src) {\r\n        var _c = docume" +
"nt.getElementById(divID);\r\n        _c.innerHTML = \"\";\r\n        var image = docum" +
"ent.createElement(\"img\");\r\n        image.setAttribute(\"src\", src);\r\n        imag" +
"e.style.position = \"absolute\";\r\n        image.style.margin = \"0px\";\r\n        ima" +
"ge.style.left = \"0px\";\r\n        image.style.top = \"0px\";\r\n        _c.appendChild" +
"(image);\r\n        return image;\r\n    }\r\n</script>");

        }
    }
}
#pragma warning restore 1591
