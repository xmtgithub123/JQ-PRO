#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    #line 1 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
    using JQ.Web;
    
    #line default
    #line hidden
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/ProjFeeDetail/ExcelData.cshtml")]
    public partial class _Views_ProjFeeDetail_ExcelData_cshtml : System.Web.Mvc.WebViewPage<dynamic>
    {
        public _Views_ProjFeeDetail_ExcelData_cshtml()
        {
        }
        public override void Execute()
        {
WriteLiteral("\r\n");

            
            #line 3 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
 using (Html.BeginForm("save", "ProjFeeDetail", FormMethod.Post, new { @area = "Project", @id = "ExcelDataForm" }))
{

            
            #line default
            #line hidden
WriteLiteral("    <table");

WriteLiteral(" class=\"table table-bordered\"");

WriteLiteral(">\r\n        <tr>\r\n            <td");

WriteLiteral(" colspan=\"3\"");

WriteLiteral(">插入日志</td>\r\n        </tr>\r\n        <tbody");

WriteLiteral(" id=\"HtmlLog\"");

WriteLiteral("></tbody>\r\n    </table>\r\n");

            
            #line 11 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"


            
            #line default
            #line hidden
WriteLiteral("    <div");

WriteLiteral(" style=\"display:none;\"");

WriteLiteral(">\r\n        <a");

WriteLiteral(" id=\"downFileTemp\"");

WriteAttribute("href", Tuple.Create(" href=\"", 363), Tuple.Create("\"", 387)
            
            #line 13 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
, Tuple.Create(Tuple.Create("", 370), Tuple.Create<System.Object, System.Int32>(ViewBag.ModelUrl
            
            #line default
            #line hidden
, 370), false)
);

WriteLiteral("></a>\r\n");

            
            #line 14 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
        
            
            #line default
            #line hidden
            
            #line 14 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
          
            var uploader = new DataModel.FileUploader();
            uploader.RefID = 0;
            uploader.RefTable = "TempExcelData";
            uploader.Name = "ExcelData_File1";
            
            
            #line default
            #line hidden
            
            #line 19 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
        Write(Html.Partial("~/Areas/Core/Views/UserControl/FileUploader.cshtml", uploader));

            
            #line default
            #line hidden
            
            #line 19 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
                                                                                           
        
            
            #line default
            #line hidden
WriteLiteral("\r\n    </div>\r\n");

            
            #line 22 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"


            
            #line default
            #line hidden
WriteLiteral("    <script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(@">
        JQ.form.submitInit({
            formid: 'ProjFeeDetailForm',//formid提交需要用到
            //buttonTypes: ['submit', 'close'],//默认按钮
            buttons: [{
                icon: 'fa fa-upload',
                text: '选择文件',
                onClick: getFiles,
            }, {
                icon: 'fa fa-download',
                text: '下载模版',
                onClick: downFile
            }],
            succesCollBack: function (data) {//成功回调函数,data为服务器返回值
                var tab = $('#mainTab').tabs('getSelected');
                var index = $('#mainTab').tabs('getTabIndex', tab);

                $(""#mainTab"").find(""iframe"")[index].contentWindow.refreshGrid();
                //JQ.datagrid.autoRefdatagrid();//刷新上一级数据表格，必须在close窗体前调用
                JQ.dialog.dialogClose();//关闭窗体放在最后一步执行，以避免找不到事件源
            },
        });

        function downFile() {
            $(""#downFileTemp"")[0].click();
        }

        //获取文件
        function getFiles() {
            var UpdateBtn = $(""a[id^='upload_']"", $(""#ExcelDataForm""));
            if (UpdateBtn.length == 1) {
                if (typeof (JQ.Upload.init.prototype.fileUploaded) == ""function"") {
                    var JQuploader = uploader_");

            
            #line 55 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
                                          Write(Html.ViewContext.Controller.ViewData["UploadFileUnqiueID"]);

            
            #line default
            #line hidden
WriteLiteral(";\r\n                    if ($(\"#downFileTemp\").attr(\"IsUploaded\") != \"1\") {\r\n     " +
"                   $(\"#downFileTemp\").attr(\"IsUploaded\", \"1\");\r\n                " +
"        JQuploader.uploader.setOption(\"filters\", {\r\n                            " +
"max_file_size: \"20gb\",\r\n                            prevent_duplicates: false,\r\n" +
"                            mime_types: [\r\n                                { tit" +
"le: \"\", extensions: \"xls,xlsx\" }\r\n                            ]\r\n               " +
"         });\r\n                        JQuploader.uploader.bind(\"UploadComplete\"," +
" function (uploader, files) {\r\n                            if (files.length > 0)" +
" {\r\n                                InsertLog((new Date()).format(\"yyyy-MM-dd hh" +
":mm:ss\"), \"\", \"文件上传成功！\");\r\n                               \r\n                    " +
"            getAjaxTable();\r\n                            }\r\n                    " +
"    });\r\n                        JQuploader.uploader.bind(\"Error\", function (upl" +
"oader, errObject) {\r\n                            InsertLog((new Date()).format(\"" +
"yyyy-MM-dd hh:mm:ss\"), errObject.file.name, \"上传文件类型错误！\");\r\n                     " +
"       //$(\"<tr><td>\" + (new Date()).format(\"yyyy-MM-dd hh:mm:ss\") + \"</td><td>\"" +
" + errObject.file.name + \"</td><td>上传文件类型错误！</td></tr>\").prependTo($(\"#HtmlLog\")" +
");\r\n\r\n                        });\r\n                    }\r\n\r\n                    " +
"UpdateBtn.click();\r\n                }\r\n\r\n            } else {\r\n                J" +
"Q.dialog.warning(\"未找到上传事件！\");\r\n            }\r\n        }\r\n\r\n        function getA" +
"jaxTable() {\r\n            var rows = $(\"table[id^=\'files_\']\", $(\"#ExcelDataForm\"" +
")).datagrid(\"getRows\");\r\n            var FileArray = Enumerable.From(rows).Selec" +
"t(\"x=>x.RemoteName\").ToArray();\r\n\r\n            //InsertLog((new Date()).format(\"" +
"yyyy-MM-dd hh:mm:ss\"), errObject.file.name, \"上传文件类型错误！\");\r\n            JQ.tools." +
"ajax({\r\n                url: \"");

            
            #line 93 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
                 Write(Url.Action("GetExcelData"));

            
            #line default
            #line hidden
WriteLiteral("\",\r\n                data: { \'files\': JSON.stringify(FileArray) },\r\n              " +
"  succesCollBack: function (data) {\r\n                    if (data.stateValue > 0" +
") {\r\n                        //JQ.dialog.show(\"插入成功！\");\r\n                       " +
" var ArrayData = data.stateMsg;\r\n                        if (ArrayData.length > " +
"0) {\r\n                            $.each(ArrayData, function (i, e) {\r\n         " +
"                       InsertLog((new Date()).format(\"yyyy-MM-dd hh:mm:ss\"), \"\"," +
" e.Msg);\r\n                            })\r\n                        }\r\n           " +
"             var tab = $(\'#mainTab\').tabs(\'getSelected\');\r\n                     " +
"   var index = $(\'#mainTab\').tabs(\'getTabIndex\', tab);\r\n                        " +
"$(\"#mainTab\").find(\"iframe\")[index].contentWindow.refreshGrid();\r\n              " +
"      }\r\n                    else {\r\n                        InsertLog((new Date" +
"()).format(\"yyyy-MM-dd hh:mm:ss\"), \"\", data.stateMsg);\r\n                    }\r\n " +
"               }\r\n            });\r\n            //删除文件\r\n            if (FileArray" +
" && FileArray.length > 0) {\r\n                $.each(FileArray, function (i, e) {" +
"\r\n                    $(\"table[id^=\'files_\']\", $(\"#ExcelDataForm\")).datagrid(\"de" +
"leteRow\", i);\r\n                });\r\n            }        \r\n        }\r\n\r\n        " +
"function InsertLog(dateStr, fileName, ErrorName) {\r\n            $(\"<tr><td style" +
"=\'width:30%\'>\" + dateStr + \"</td><td style=\'width:30%\'>\" + fileName + \"</td><td>" +
"\" + ErrorName + \"</td></tr>\").prependTo($(\"#HtmlLog\"));\r\n        }\r\n    </script" +
">\r\n");

            
            #line 125 "..\..\Views\ProjFeeDetail\ExcelData.cshtml"
            }

            
            #line default
            #line hidden
        }
    }
}
#pragma warning restore 1591
