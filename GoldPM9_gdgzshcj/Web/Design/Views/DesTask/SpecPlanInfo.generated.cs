#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/DesTask/SpecPlanInfo.cshtml")]
    public partial class _Views_DesTask_SpecPlanInfo_cshtml : System.Web.Mvc.WebViewPage<dynamic>
    {
        public _Views_DesTask_SpecPlanInfo_cshtml()
        {
        }
        public override void Execute()
        {
            
            #line 1 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
  
    Layout = "~/Areas/Core/Views/Shared/_Layout.cshtml";

            
            #line default
            #line hidden
WriteLiteral("\r\n\r\n");

DefineSection("head", () => {

WriteLiteral("\r\n    <style>\r\n        .tree-file {\r\n            background-image: none;\r\n       " +
" }\r\n\r\n        .panel-body {\r\n            padding: 0px !important;\r\n        }\r\n\r\n" +
"        .tabs-panels {\r\n            border-style: none !important;\r\n        }\r\n\r" +
"\n        .wordpage {\r\n            margin: 20px;\r\n            background-color: #" +
"FFFFFF;\r\n            -moz-box-shadow: 0px 0px 7px #808080;\r\n            -webkit-" +
"box-shadow: 0px 0px 7px #808080;\r\n            box-shadow: 0px 0px 7px #808080;\r\n" +
"        }\r\n\r\n        #divSpecPlan .panel-body {\r\n            border-width: 1px;\r" +
"\n            border-style: solid;\r\n        }\r\n\r\n        #divSpecPlan td[field=\"T" +
"askNames\"] > div > span {\r\n            display: table-cell;\r\n            vertica" +
"l-align: middle;\r\n        }\r\n\r\n            #divSpecPlan td[field=\"TaskNames\"] > " +
"div > span.tree-hit,\r\n            #divSpecPlan td[field=\"TaskNames\"] > div > spa" +
"n.tree-line,\r\n            #divSpecPlan td[field=\"TaskNames\"] > div > span.tree-j" +
"oin,\r\n            #divSpecPlan td[field=\"TaskNames\"] > div > span.tree-indent,\r\n" +
"            #divSpecPlan td[field=\"TaskNames\"] > div > span.tree-joinbottom {\r\n " +
"               width: 16px;\r\n                border-color: #fafafa;\r\n           " +
"     border-style: solid;\r\n                border-width: 5px 0 5px 0;\r\n         " +
"   }\r\n\r\n        #divSpecPlan tr.datagrid-row-selected td[field=\"TaskNames\"] > di" +
"v > span.tree-hit,\r\n        #divSpecPlan tr.datagrid-row-selected td[field=\"Task" +
"Names\"] > div > span.tree-line,\r\n        #divSpecPlan tr.datagrid-row-selected t" +
"d[field=\"TaskNames\"] > div > span.tree-join,\r\n        #divSpecPlan tr.datagrid-r" +
"ow-selected td[field=\"TaskNames\"] > div > span.tree-indent,\r\n        #divSpecPla" +
"n tr.datagrid-row-selected td[field=\"TaskNames\"] > div > span.tree-joinbottom {\r" +
"\n            border-color: #85BDE2;\r\n        }\r\n\r\n        #divSpecPlan tr.datagr" +
"id-row-over td[field=\"TaskNames\"] > div > span.tree-hit,\r\n        #divSpecPlan t" +
"r.datagrid-row-over td[field=\"TaskNames\"] > div > span.tree-line,\r\n        #divS" +
"pecPlan tr.datagrid-row-over td[field=\"TaskNames\"] > div > span.tree-join,\r\n    " +
"    #divSpecPlan tr.datagrid-row-over td[field=\"TaskNames\"] > div > span.tree-in" +
"dent,\r\n        #divSpecPlan tr.datagrid-row-over td[field=\"TaskNames\"] > div > s" +
"pan.tree-joinbottom {\r\n            border-color: #85BDE2;\r\n        }\r\n    </styl" +
"e>\r\n    <style>\r\n        .btn-medium {\r\n            padding: 5px 15px;\r\n        " +
"    font-size: 18px;\r\n            color: white !important;\r\n        }\r\n\r\n       " +
" .pageheader {\r\n            text-align: center;\r\n        }\r\n\r\n            .pageh" +
"eader h1 {\r\n                font-size: 24px;\r\n                font-weight: bold;" +
"\r\n                padding: 20px 10px 10px 10px;\r\n            }\r\n\r\n        .pagef" +
"oot {\r\n            text-align: center;\r\n            padding: 10px 10px 20px 10px" +
";\r\n        }\r\n\r\n            .pagefoot .l-btn-text {\r\n                vertical-al" +
"ign: middle !important;\r\n            }\r\n\r\n            .pagefoot .btn-blue {\r\n   " +
"             background: -webkit-linear-gradient(top,#67c2ff 0,#3d93cf 100%);\r\n " +
"               background: -moz-linear-gradient(top,#67c2ff 0,#3d93cf 100%);\r\n  " +
"              background: -o-linear-gradient(top,#67c2ff 0,#3d93cf 100%);\r\n     " +
"           background: linear-gradient(top,#67c2ff 0,#3d93cf 100%);\r\n           " +
"     border: none;\r\n            }\r\n\r\n            .pagefoot .btn-green {\r\n       " +
"         background: -webkit-linear-gradient(top,#6cd2b7 0,#69a898 100%);\r\n     " +
"           background: -moz-linear-gradient(top,#6cd2b7 0,#69a898 100%);\r\n      " +
"          background: -o-linear-gradient(top,#6cd2b7 0,#69a898 100%);\r\n         " +
"       background: linear-gradient(top,#6cd2b7 0,#69a898 100%);\r\n               " +
" border: none;\r\n            }\r\n\r\n            .pagefoot .btn-blue:hover {\r\n      " +
"          background: #3d93cf;\r\n            }\r\n\r\n            .pagefoot .btn-gree" +
"n:hover {\r\n                background: #69a898;\r\n            }\r\n\r\n        .ml-10" +
" {\r\n            margin-left: 10px;\r\n        }\r\n\r\n        .mr-10 {\r\n            m" +
"argin-right: 10px;\r\n        }\r\n\r\n        .datagrid-toolbar {\r\n            backgr" +
"ound-color: #ddd;\r\n        }\r\n    </style>\r\n");

});

WriteLiteral("\r\n");

DefineSection("Body_Content", () => {

WriteLiteral("\r\n\r\n    <div");

WriteLiteral(" class=\"easyui-layout\"");

WriteLiteral(" data-options=\"fit:true\"");

WriteLiteral(">\r\n        <div");

WriteLiteral(" data-options=\"region:\'north\',border:false\"");

WriteLiteral(" style=\"border-bottom-width:1px;overflow:hidden\"");

WriteLiteral(">\r\n            <div");

WriteLiteral(" style=\"height:30px;padding:5px;\"");

WriteLiteral(">\r\n                <div");

WriteLiteral(" style=\"float:left;margin-left:5px;\"");

WriteLiteral(">\r\n                    <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-save fa-lg\'\"");

WriteLiteral(" onclick=\"SaveSpecPlanInfo()\"");

WriteLiteral(">保存</a>\r\n                    <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-sitemap fa-lg\'\"");

WriteLiteral(" onclick=\"ShowProjectProgress()\"");

WriteLiteral(">查看进度</a>\r\n                </div>\r\n                <div");

WriteLiteral(" style=\"float:right;margin-right:5px;margin-top:7px;\"");

WriteLiteral(">\r\n                    节点状态：\r\n                    <span");

WriteLiteral(" class=\"node-example node-status-0-bg\"");

WriteLiteral(">未启动</span>\r\n                    <span");

WriteLiteral(" class=\"node-example node-status-1-bg\"");

WriteLiteral(">已安排</span>\r\n                    <span");

WriteLiteral(" class=\"node-example node-status-2-bg\"");

WriteLiteral(">进行中</span>\r\n                    <span");

WriteLiteral(" class=\"node-example node-status-3-bg\"");

WriteLiteral(">已完成</span>\r\n                    <span");

WriteLiteral(" class=\"node-example node-status-4-bg\"");

WriteLiteral(">已回退</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        " +
"<div");

WriteLiteral(" data-options=\"region:\'center\',border:false\"");

WriteLiteral(">\r\n            <div");

WriteLiteral(" class=\"nowordpage\"");

WriteLiteral(">\r\n                <div");

WriteLiteral(" class=\"pageheader\"");

WriteLiteral(">\r\n                    ");

WriteLiteral("\r\n                    <div");

WriteLiteral(" class=\"row-fluid-wrap\"");

WriteLiteral(">\r\n                        <ul");

WriteLiteral(" class=\"clearfix ul-fluid \"");

WriteLiteral(">\r\n                            <li");

WriteLiteral(" class=\"\"");

WriteLiteral(">\r\n                                <div");

WriteLiteral(" class=\"list-wrap\"");

WriteLiteral(">\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                    <a");

WriteLiteral(" href=\"#\"");

WriteLiteral("><div");

WriteLiteral(" class=\"small-tag\"");

WriteLiteral(">1</div></a>\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                </div>\r\n                                " +
"<div");

WriteLiteral(" class=\"clearfix\"");

WriteLiteral("></div>\r\n                                <p>计划要求</p>\r\n                           " +
" </li>\r\n                            <li");

WriteLiteral(" class=\"\"");

WriteLiteral(">\r\n                                <div");

WriteLiteral(" class=\"list-wrap\"");

WriteLiteral(">\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                    <a");

WriteLiteral(" href=\"#\"");

WriteLiteral("><div");

WriteLiteral(" class=\"small-tag\"");

WriteLiteral(">2</div></a>\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                </div>\r\n                                " +
"<div");

WriteLiteral(" class=\"clearfix\"");

WriteLiteral("></div>\r\n                                <p>项目策划</p>\r\n                           " +
" </li>\r\n                            <li");

WriteLiteral(" class=\"\"");

WriteLiteral(">\r\n                                <div");

WriteLiteral(" class=\"list-wrap\"");

WriteLiteral(">\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                    <a");

WriteLiteral(" href=\"#\"");

WriteLiteral("><div");

WriteLiteral(" class=\"small-tag\"");

WriteLiteral(">4</div></a>\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                </div>\r\n                                " +
"<div");

WriteLiteral(" class=\"clearfix\"");

WriteLiteral("></div>\r\n                                <p>提资策划</p>\r\n                           " +
" </li>\r\n                            <li");

WriteLiteral(" class=\"\"");

WriteLiteral(">\r\n                                <div");

WriteLiteral(" class=\"list-wrap\"");

WriteLiteral(">\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                    <a");

WriteLiteral(" href=\"#\"");

WriteLiteral("><div");

WriteLiteral(" class=\"small-tag\"");

WriteLiteral(">3</div></a>\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                </div>\r\n                                " +
"<div");

WriteLiteral(" class=\"clearfix\"");

WriteLiteral("></div>\r\n                                <p>专业策划</p>\r\n                           " +
" </li>\r\n                            <li");

WriteLiteral(" class=\"\"");

WriteLiteral(">\r\n                                <div");

WriteLiteral(" class=\"list-wrap\"");

WriteLiteral(">\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                    <a");

WriteLiteral(" href=\"#\"");

WriteLiteral("><div");

WriteLiteral(" class=\"small-tag\"");

WriteLiteral(">5</div></a>\r\n                                    <div");

WriteLiteral(" class=\"line\"");

WriteLiteral("></div>\r\n                                </div>\r\n                                " +
"<div");

WriteLiteral(" class=\"clearfix\"");

WriteLiteral("></div>\r\n                                <p>关键节点</p>\r\n                           " +
" </li>\r\n                        </ul>\r\n                    </div>\r\n             " +
"   </div>\r\n\r\n                <div");

WriteLiteral(" id=\"divSpecPlan\"");

WriteLiteral(" style=\"margin:20px;\"");

WriteLiteral(">\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    " +
"<script");

WriteAttribute("src", Tuple.Create(" src=\"", 8332), Tuple.Create("\"", 8377)
            
            #line 208 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
, Tuple.Create(Tuple.Create("", 8338), Tuple.Create<System.Object, System.Int32>(Url.Content("~/Scripts/JQ/DesFlow.js")
            
            #line default
            #line hidden
, 8338), false)
);

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral("></script>\r\n\r\n    <script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(@">

        Array.prototype.indexOf = function (oValue) {
            /// <summary>在数组中查找对应值，返回所在位置</summary>
            /// <param name=""oValue"" type=""Object"">要进行匹配的对象</param>
            var n = -1;
            for (var i = 0; i < this.length; i++) {
                if (this[i] == oValue) {
                    n = i;
                    break;
                }
            }
            return n;
        };

        Array.prototype.isIndexOf = function (oValue) {
            /// <summary>在数组中查找有无对应值</summary>
            /// <param name=""oValue"" type=""Object"">要进行匹配的对象</param>
            return this.indexOf(oValue) == -1 ? false : true;
        };



        var _webconfig = {
            serverUrl: '");

            
            #line 234 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                   Write(Url.Content("~"));

            
            #line default
            #line hidden
WriteLiteral("\'\r\n        };\r\n\r\n        var _enum_Design_NodeType_专业 = ");

            
            #line 237 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                   Write((int)DataModel.NodeType.专业);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_NodeType_设计 = ");

            
            #line 238 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                   Write((int)DataModel.NodeType.设计);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_NodeType_审定 =");

            
            #line 239 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                  Write((int)DataModel.NodeType.批准);

            
            #line default
            #line hidden
WriteLiteral(";\r\n\r\n        var _enum_Design_TaskStatus_未启动 = ");

            
            #line 241 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                      Write((int)DBSql.Design.TaskStatus.未启动);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_TaskStatus_已安排 = ");

            
            #line 242 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                      Write((int)DBSql.Design.TaskStatus.已安排);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_TaskStatus_进行中 = ");

            
            #line 243 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                      Write((int)DBSql.Design.TaskStatus.进行中);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_TaskStatus_已完成 = ");

            
            #line 244 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                      Write((int)DBSql.Design.TaskStatus.已完成);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_TaskStatus_已停止 = ");

            
            #line 245 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                      Write((int)DBSql.Design.TaskStatus.已停止);

            
            #line default
            #line hidden
WriteLiteral(";\r\n\r\n        var _enum_Design_FlowNodeStatus_未安排 = ");

            
            #line 247 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                          Write((int)DBSql.Design.FlowNodeStatus.未安排);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _enum_Design_FlowNodeStatus_已安排 = ");

            
            #line 248 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                          Write((int)DBSql.Design.FlowNodeStatus.已安排);

            
            #line default
            #line hidden
WriteLiteral(";\r\n\r\n        var _enum_Design_TaskLevelType_层级父 = ");

            
            #line 250 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                                         Write((int)DBSql.Design.TaskLevelType.层级父);

            
            #line default
            #line hidden
WriteLiteral(";\r\n\r\n        var _currentUserId = ");

            
            #line 252 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                        Write(ViewBag.currentUserId);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _taskSpecId = ");

            
            #line 253 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                     Write(ViewBag.taskSpecId);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _projID = ");

            
            #line 254 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                 Write(ViewBag.projID);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _taskGroupId = ");

            
            #line 255 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                      Write(ViewBag.taskGroupId);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _taskGroupEmpID = ");

            
            #line 256 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                         Write(ViewBag.TaskGroupModel.TaskGroupEmpID);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var XMFFZR=");

            
            #line 257 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
              Write(ViewBag.FXMFZR);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _projEmpId = ");

            
            #line 258 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                    Write(ViewBag.projEmpId);

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _projEmpName = \'");

            
            #line 259 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                       Write(Html.Raw(ViewBag.projEmpName));

            
            #line default
            #line hidden
WriteLiteral("\';\r\n\r\n        var _permission = ");

            
            #line 261 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                     Write(Html.Raw(ViewBag.permission));

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _mainTabsUsed = ");

            
            #line 262 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                       Write(Html.Raw(ViewBag.mainTabsUsed));

            
            #line default
            #line hidden
WriteLiteral(";\r\n        var _DesFlow=");

            
            #line 263 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                Write(Html.Raw(ViewBag.DesFlow));

            
            #line default
            #line hidden
WriteLiteral("; // 可用生产流程列表\r\n        var _Qualification=");

            
            #line 264 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                      Write(Html.Raw(ViewBag.Qualification));

            
            #line default
            #line hidden
WriteLiteral("; // 普通生产流程人员资格列表\r\n\r\n\r\n        var _tempTaskId=0; // 页面上新创建任务的临时ID\r\n        var _" +
"SpecPlanData; // 专业策划数据\r\n\r\n        var tabId = 0;\r\n        var tabNum = 0;\r\n\r\n  " +
"      var tabs = [\r\n            _webconfig.serverUrl + \'Design/DesTask/PlanTable" +
"Info?projID={0}&taskGroupId={1}&taskSpecId={2}\'.format(_projID, _taskGroupId, _t" +
"askSpecId),\r\n            _webconfig.serverUrl + \'Design/DesTask/ProjectPlanInfo?" +
"projID={0}&taskGroupId={1}&taskSpecId={2}\'.format(_projID, _taskGroupId, _taskSp" +
"ecId),\r\n            _webconfig.serverUrl + \'Design/DesExch/ExchPlanInfo?projID={" +
"0}&taskGroupId={1}&taskSpecId={2}\'.format(_projID, _taskGroupId, _taskSpecId),\r\n" +
"            _webconfig.serverUrl + \'Design/DesTask/SpecPlanInfo?projID={0}&taskG" +
"roupId={1}&taskSpecId={2}\'.format(_projID, _taskGroupId, _taskSpecId),\r\n        " +
"    _webconfig.serverUrl + \'Design/DesTask/ProjectGantt?projID={0}&taskGroupId={" +
"1}&taskSpecId={2}\'.format(_projID, _taskGroupId, _taskSpecId)\r\n        ];\r\n\r\n   " +
"     // 获取流程\r\n        function GetDesFlow(SpecId,leveType) {\r\n            if (Sp" +
"ecId==0) {\r\n                //汇总专业\r\n                return Enumerable.From(_DesF" +
"low).Where(\"x=>x.FlowSpecType==1&&x.FlowLevelType==\" +leveType +\"\").FirstOrDefau" +
"lt();\r\n            }\r\n            else {\r\n                //普通专业\r\n              " +
"  return Enumerable.From(_DesFlow).Where(\"x=>x.FlowSpecType==0&&x.FlowLevelType=" +
"=\" +leveType +\"\").FirstOrDefault();\r\n            }\r\n        }\r\n\r\n        // 格式化时" +
"间，并且 1900 返回空\r\n        function checkDate(strDate, strFormat) {\r\n            var" +
" jd = Date.jsonStringToDate(strDate);\r\n            if (jd.getFullYear() == 1900)" +
" return \"\";\r\n            return jd.format(strFormat);\r\n        }\r\n\r\n        // 检" +
"测是否有关联任务\r\n        function checkRelation(oSender) {\r\n            // 只有汇总专业中的任务才需" +
"要做这个判断\r\n            if (oSender.TaskSpecId != 0) return false;\r\n            // 遍" +
"历各专业表格\r\n            var hasSumChild = false;\r\n            $.each($(\"table[id^=\'S" +
"pec_\']\"),function (n,t) {\r\n                if (hasSumChild == true) return;\r\n   " +
"             var $grid=$(this);\r\n                if ($grid.attr(\"id\") == \'Spec_0" +
"\') {\r\n                    hasSumChild = false;\r\n                    return;\r\n   " +
"             }\r\n                var rowData=$grid.treegrid(\"getData\");\r\n        " +
"        // 遍历表格行，保存任务数据\r\n                $.each(rowData,function (i,e) {\r\n      " +
"              if (hasSumChild == true) return;\r\n                    if (e.TaskNe" +
"xtFlowNodeId == oSender.Id) {\r\n                        hasSumChild = true;\r\n    " +
"                    return;\r\n                    }\r\n                });\r\n       " +
"     });\r\n            return hasSumChild;\r\n        }\r\n\r\n        // 验证任务行数据\r\n    " +
"    function checkTaskValist(id) {\r\n            var result =true;\r\n            i" +
"f (!$(\"input[taskName][rootId=\'\"+id+\"\']\").textbox(\"isValid\")) {\r\n               " +
" var winHeight=document.documentElement.clientHeight\r\n                var _top =" +
"$(\"input[taskName][rootId=\'\"+id+\"\']\").next().offset().top-(winHeight/2);\r\n      " +
"          $(\"input[taskName][rootId=\'\"+id+\"\']\").textbox(\"textbox\").focus();\r\n   " +
"             $(\"#divSpecPlan\").parent()[0].scrollTop=_top;\r\n                resu" +
"lt=false;\r\n                return false;\r\n            }\r\n            if (!$(\"inp" +
"ut[dateStart][rootId=\'\"+id+\"\']\").datebox(\"isValid\")) {\r\n                var winH" +
"eight=document.documentElement.clientHeight\r\n                var _top =$(\"input[" +
"dateStart][rootId=\'\"+id+\"\']\").next().offset().top-(winHeight/2);\r\n              " +
"  $(\"#divSpecPlan\").parent()[0].scrollTop=_top;\r\n                $(\"input[dateSt" +
"art][rootId=\'\"+id+\"\']\").datebox(\"textbox\").focus();\r\n                result=fals" +
"e;\r\n                return false;\r\n            }\r\n            if (!$(\"input[date" +
"End][rootId=\'\"+id+\"\']\").datebox(\"isValid\")) {\r\n                var winHeight=doc" +
"ument.documentElement.clientHeight\r\n                var _top =$(\"input[dateEnd][" +
"rootId=\'\"+id+\"\']\").next().offset().top-(winHeight/2);\r\n                $(\"#divSp" +
"ecPlan\").parent()[0].scrollTop=_top;\r\n                $(\"input[dateEnd][rootId=\'" +
"\"+id+\"\']\").datebox(\"textbox\").focus();\r\n                result=false;\r\n         " +
"       return false;\r\n            }\r\n\r\n            $.each($(\"div[empPlan][rootId" +
"=\'\"+id+\"\']\").find(\"select\"),function (i,e) {\r\n                if (!result) {\r\n  " +
"                  result=false;\r\n                    return false;\r\n            " +
"    }\r\n                if (!$(e).combobox(\"isValid\")) {\r\n                    var" +
" winHeight=document.documentElement.clientHeight\r\n                    var _top =" +
"$(e).next().offset().top-(winHeight/2);\r\n                    $(\"#divSpecPlan\").p" +
"arent()[0].scrollTop=_top;\r\n                    //$(e).combobox(\"textbox\").focus" +
"();\r\n                    JQ.dialog.show(\"人员选择失败！\");\r\n                    result=" +
"false;\r\n                    return false;\r\n                }\r\n\r\n            })\r\n" +
"\r\n            return result;\r\n        }\r\n\r\n        // 显示专业面板\r\n        function c" +
"reateSpecPlan() {\r\n            debugger;\r\n            _tempTaskId=0;//初始化\r\n     " +
"       $.getJSON(_webconfig.serverUrl + \'Design/DesTask/SpecPlanInfoGetSpecPlanD" +
"ataJson?taskGroupId={0}&taskSpecId={1}\'.format(_taskGroupId, _taskSpecId),functi" +
"on (data) {\r\n                _SpecPlanData=data.rows;\r\n                var SpecA" +
"rray=Enumerable.From(_SpecPlanData).Where(\"x=>x.TaskType==1\").ToArray();\r\n      " +
"          var $divContain=$(\"#divSpecPlan\");//显示容器\r\n                $.each(SpecA" +
"rray,function (fatherIdIndex,fatherIdData) {\r\n\r\n                    //生成专业面板工具栏\r" +
"\n                    var $toolbar=$(\"<div id=\\\"bar_\"+fatherIdData.TaskSpecId+\"\\\"" +
" style=\\\"padding:5px;height:auto;\\\"></div>\");\r\n                    $toolbar.appe" +
"ndTo($divContain);\r\n                    createSpecToolbar($toolbar,fatherIdData)" +
";\r\n\r\n                    //生成专业内任务列表（树状列表）\r\n                    var $tableEle=$(" +
"\"<table id=\\\"Spec_\"+fatherIdData.TaskSpecId+\"\\\" style=\\\"width:99%\\\"></table>\");\r" +
"\n                    $tableEle.appendTo($divContain);\r\n                    creat" +
"eSpecTreeGrid($tableEle,fatherIdData);\r\n\r\n                    //各专业面板之间预留空隙\r\n   " +
"                 var $divpadding=$(\"<div style=\\\"padding-top:30px\\\"></div>\");\r\n " +
"                   $divpadding.appendTo($divContain);\r\n\r\n                })\r\n\r\n " +
"           }).error(function () {\r\n                JQ.dialog.warning(\"专业策划获取数据失败" +
"！！！\");\r\n            })\r\n        }\r\n\r\n        // 添加toolbar\r\n        function crea" +
"teSpecToolbar($toolbar, fatherData) {\r\n            //显示专业名称\r\n            var $to" +
"olbarPanel = $(\"<span JQPanel=\\\"toolbarPanel\\\"></span>\");\r\n            $(\"<span " +
"style=\\\"font-weight:bold;display:inline-block;width:120px;text-overflow:ellipsis" +
";\\\"><strong style=\\\"padding:10px;\\\">\"+fatherData.TaskName+\"</strong></span>\").ap" +
"pendTo($toolbarPanel);\r\n            $(\"<span style=\\\"font-weight:bold;display:in" +
"line-block;width: 80px;text-overflow:ellipsis;\\\"><strong style=\\\"padding:10px;\\\"" +
"><i class=\\\"fa fa-user\\\"></i>&nbsp;\"+fatherData.TaskEmpName+\"</strong></span>\")." +
"appendTo($toolbarPanel);\r\n            $(\"<span style=\\\"font-weight:bold;display:" +
"inline-block;width:200px;text-overflow:ellipsis;\\\"><strong style=\\\"padding:10px;" +
"\\\"><i class=\\\"fa fa-calendar\\\"></i>&nbsp;\" + checkDate(fatherData.DatePlanStart," +
" \"yyyy-MM-dd\") + \" ~ \" + checkDate(fatherData.DatePlanFinish, \"yyyy-MM-dd\") +\"</" +
"strong></span>\").appendTo($toolbarPanel);\r\n            $(\"<span class=\'datagrid-" +
"btn-separator\' style=\'padding-right:5px;vertical-align: middle; height: 22px;dis" +
"play:inline-block;float:none\'></span>\").appendTo($toolbarPanel);\r\n            if" +
" (_taskGroupEmpID == _currentUserId|| XMFFZR==_currentUserId|| fatherData.TaskEm" +
"pID == _currentUserId || _permission.indexOf(\"alledit\") > -1) {\r\n               " +
" if (1==1) {\r\n                    //if (fatherData.TaskName != \"测量\" && fatherDat" +
"a.TaskName != \"物探\" && fatherData.TaskName != \"勘探\" && fatherData.TaskName != \"勘测\"" +
") {\r\n                    // 如果你是项目负责人、专业的负责人，或者你拥有该模块的维护权。\r\n                    " +
"$(\"<a class=\\\"easyui-linkbutton\\\" data-options=\\\"plain:true,iconCls:\'fa fa-list " +
"fa-lg\'\\\" onclick=\'AddTaskFather(\" + fatherData.TaskSpecId + \")\'>添加任务</a>\").appen" +
"dTo($toolbarPanel);\r\n                    $(\"<a class=\\\"easyui-linkbutton\\\" data-" +
"options=\\\"plain:true,iconCls:\'fa fa-indent fa-lg\'\\\" onclick=\'AddTaskChild(\" + fa" +
"therData.TaskSpecId + \")\'>添加子任务</a>\").appendTo($toolbarPanel);\r\n                " +
"}\r\n\r\n                if (fatherData.TaskSpecId == 0) {\r\n                    $(\"<" +
"a class=\\\"easyui-linkbutton jq-btn-success\\\" data-options=\\\"plain:true,iconCls:\'" +
"fa fa-code-fork fa-lg\'\\\" onclick=\'AddSummaryChild(\"+fatherData.TaskSpecId+\")\'>设置" +
"关联任务</a>\").appendTo($toolbarPanel);\r\n                }\r\n            }\r\n         " +
"   $toolbarPanel.appendTo($toolbar);\r\n        }\r\n\r\n        // 生成专业内任务列表（树状列表）\r\n " +
"       function createSpecTreeGrid($tableEle,fatherIdData) {\r\n            var ch" +
"ildData=Enumerable.From(_SpecPlanData).Where(\"x=>x.TaskSpecId==\"+fatherIdData.Ta" +
"skSpecId+\"&&x.TaskType==0\").OrderBy(\"x=>x.TaskPath\").ToArray();\r\n            if " +
"(_taskGroupEmpID == _currentUserId || fatherIdData.TaskEmpID == _currentUserId |" +
"| _permission.indexOf(\"alledit\")>-1) {\r\n                // 如果你是项目负责人、专业的负责人，或者你拥" +
"有该模块的维护权。\r\n                JQ.treegrid.treegrid({\r\n                    toolbar: " +
"\'#bar_\'+fatherIdData.TaskSpecId,\r\n                    JQPrimaryID: \'Id\',//主键的字段\r" +
"\n                    JQID: \"Spec_\"+fatherIdData.TaskSpecId,//数据表格ID\r\n           " +
"         JQLoadingType: \'treegrid\',//数据表格类型 [datagrid,datagrid]\r\n               " +
"     checkOnSelect:false,\r\n                    selectOnCheck:false,\r\n           " +
"         idField: \'Id\',\r\n                    treeField: \'TaskNames\',\r\n          " +
"          fit:false,\r\n                    collapsible:true,\r\n                   " +
" lines: true,\r\n                    data:{rows:childData},\r\n                    r" +
"ownumbers: false,\r\n                    //frozenColumns: [[  ]],\r\n               " +
"     columns: [[\r\n                        { title: \'ID\', field: \'Id\', width: 50," +
" align: \'center\' },\r\n                        { field: \'ck\', align: \'center\', che" +
"ckbox: true, JQIsExclude: true },\r\n                        { title: \'任务名称\', fiel" +
"d: \'TaskNames\', width: 340, align: \'left\',halign:\'center\',formatter:function (va" +
"lue,row,index) {\r\n                            debugger\r\n                        " +
"    return \"<input  rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId+\"\' rem" +
"ark=\'0\' taskNumber placeholder=\\\"任务编号\\\" style=\\\"width:100px\\\" value=\'\"+row.TaskN" +
"umber.escapeHTML()+\"\' ></input>&nbsp;\" +\r\n                                   \"<i" +
"nput  rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId+\"\' remark=\'0\' taskNa" +
"me placeholder=\\\"任务名称\\\" style=\\\"width:170px\\\" value=\'\"+row.TaskName.escapeHTML()" +
"+\"\' ></input>\";\r\n                        }},\r\n                        { title: \'" +
"生产节点人员安排\', field: \'12\', width: 620, align: \'left\',halign:\'center\',formatter:func" +
"tion (value,row,index) {\r\n                            return \"<div class=\\\"swipe" +
"\\\"><div empPlan rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId+\"\' class=\\" +
"\"approve-progress\\\" remark=\'0\'></div></div>\";\r\n                        } },\r\n   " +
"                     { title: \'计划开始\', field: \'DatePlanStart\', width: 105, align:" +
" \'left\',halign:\'center\',formatter:function (value,row,index) {\r\n                " +
"            return \"<input rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId" +
"+\"\' remark=\'0\' dateStart style=\\\"width:98%\\\" value=\'\"+row.DatePlanStart+\"\' ></in" +
"put>\";\r\n                        } },\r\n                        { title: \'计划完成\', f" +
"ield: \'DatePlanFinish\', width: 105, align: \'left\',halign:\'center\',formatter:func" +
"tion (value,row,index) {\r\n                            return \"<input rootId=\'\"+r" +
"ow.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId+\"\' remark=\'0\' dateEnd  style=\\\"width:" +
"98%\\\" value=\'\"+row.DatePlanFinish+\"\'></input>\";\r\n                        } },\r\n " +
"                       { title: \'操作\', field: \'123\', width: 220, align: \'left\',ha" +
"lign:\'center\' ,formatter:function (value,row,index) {\r\n                         " +
"   var btnHtml=\"\";\r\n                            if (row.Id>0) {\r\n               " +
"                 btnHtml+=\"<a rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpe" +
"cId+\"\' remark=\'0\' btnEdit  onclick=\\\"return showTaskInfo(\'\"+fatherIdData.TaskSpe" +
"cId+\"\',\'\"+row.Id+\"\')\\\"  class=\\\"easyui-linkbutton jq-btn-info\\\">查看</a> \";\r\n     " +
"                       }\r\n                            if (row.Id > 0 && (row.Tas" +
"kStatus == _enum_Design_TaskStatus_进行中 || row.TaskStatus == _enum_Design_TaskSta" +
"tus_已停止)) {\r\n                                btnHtml+=\"<a rootId=\'\"+row.Id+\"\' sp" +
"ecId=\'\"+fatherIdData.TaskSpecId+\"\' remark=\'0\' btnChange  onclick=\\\"return transf" +
"erTask(\'\"+fatherIdData.TaskSpecId+\"\',\'\"+row.Id+\"\')\\\"  class=\\\"easyui-linkbutton " +
"jq-btn-warning\\\">移交</a> \";\r\n                            }\r\n                     " +
"       btnHtml+=\"<a rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId+\"\' rem" +
"ark=\'0\' btn  onclick=\\\"delTask(\'\"+fatherIdData.TaskSpecId+\"\',\'\"+row.Id+\"\')\\\"  cl" +
"ass=\\\"easyui-linkbutton jq-btn-danger\\\">删除</a> \";\r\n                            r" +
"eturn btnHtml;\r\n                        } },\r\n                        { title: \'" +
"父任务\', field: \'TaskNextFlowNodeId\', width: 60, align: \'center\'}\r\n                " +
"    ]],\r\n                    onLoadSuccess: function (row, data) {\r\n            " +
"            if (fatherIdData.TaskName == \"勘测\") {\r\n                            va" +
"r data = $(\"#Spec_\" + fatherIdData.TaskSpecId).treegrid(\"getData\");\r\n           " +
"                 if (data.length == 0) {\r\n                                AutoTa" +
"sk(fatherIdData.TaskSpecId);\r\n                            }\r\n                   " +
"     }\r\n                        tablebound(false, fatherIdData);\r\n              " +
"      }\r\n                });\r\n            } else {\r\n                // 你没有权限执行该操" +
"作,页面只读。\r\n                JQ.treegrid.treegrid({\r\n                    toolbar: \'#" +
"bar_\'+fatherIdData.TaskSpecId,\r\n                    JQPrimaryID: \'Id\',//主键的字段\r\n " +
"                   JQID: \"Spec_\"+fatherIdData.TaskSpecId,//数据表格ID\r\n             " +
"       JQLoadingType: \'treegrid\',//数据表格类型 [datagrid,datagrid]\r\n                 " +
"   checkOnSelect:false,\r\n                    selectOnCheck:false,\r\n             " +
"       idField: \'Id\',\r\n                    treeField: \'TaskNames\',\r\n            " +
"        fit:false,\r\n                    collapsible:true,\r\n                    l" +
"ines: true,\r\n                    data:{rows:childData},\r\n                    row" +
"numbers: false,\r\n                    //frozenColumns: [[  ]],\r\n                 " +
"   columns: [[\r\n                        {title: \'ID\', field: \'Id\', width: 50, al" +
"ign: \'center\'},\r\n                        { field: \'ck\', align: \'center\', checkbo" +
"x: true, JQIsExclude: true },\r\n                        { title: \'任务名称\', field: \'" +
"TaskNames\', width: 340, align: \'left\',halign:\'center\',formatter:function (value," +
"row,index) {\r\n                            if (row.TaskNumber == \"\") {\r\n         " +
"                       row.TaskNames = \"{0}\".format(row.TaskName.escapeHTML());\r" +
"\n                            } else {\r\n                                row.TaskN" +
"ames = \"[{0}]{1}\".format(row.TaskNumber.escapeHTML(), row.TaskName.escapeHTML())" +
";\r\n                            }\r\n                            return row.TaskNam" +
"es;\r\n                        }},\r\n                        { title: \'生产节点人员安排\', f" +
"ield: \'12\', width: 620, align: \'left\',halign:\'center\',formatter:function (value," +
"row,index) {\r\n                            return \"<div class=\\\"swipe\\\"><div empP" +
"lan rootId=\'\"+row.Id+\"\'  specId=\'\"+fatherIdData.TaskSpecId+\"\' class=\\\"approve-pr" +
"ogress\\\" remark=\'0\' ></div></div>\";\r\n                        } },\r\n             " +
"           { title: \'计划开始\', field: \'DatePlanStart\', width: 100, align: \'center\'," +
"halign:\'center\',formatter:JQ.tools.DateTimeFormatterByT},\r\n                     " +
"   { title: \'计划完成\', field: \'DatePlanFinish\', width: 100, align: \'center\',halign:" +
"\'center\',formatter:JQ.tools.DateTimeFormatterByT},\r\n                        { ti" +
"tle: \'操作\', field: \'123\', width: 220, align: \'left\',halign:\'center\' ,formatter:fu" +
"nction (value,row,index) {\r\n                            var btnHtml=\"\";\r\n       " +
"                     if (row.Id > 0) {\r\n                                btnHtml+" +
"=\"<a rootId=\'\"+row.Id+\"\' specId=\'\"+fatherIdData.TaskSpecId+\"\' remark=\'0\' btnEdit" +
"  onclick=\\\"return showTaskInfo(\'\"+fatherIdData.TaskSpecId+\"\',\'\"+row.Id+\"\')\\\"  c" +
"lass=\\\"easyui-linkbutton jq-btn-info\\\">查看</a> \";\r\n                            }\r" +
"\n                            return btnHtml;\r\n                        } },\r\n    " +
"                    { title: \'父任务\', field: \'TaskNextFlowNodeId\', width: 60, alig" +
"n: \'center\'}\r\n                    ]],\r\n                    onLoadSuccess: functi" +
"on (row, data) {\r\n                        tablebound(true, fatherIdData);\r\n     " +
"               }\r\n                });\r\n            }\r\n        }\r\n\r\n        var i" +
"sFirst = false;\r\n        function AutoTask(specId) {\r\n            isFirst = true" +
";\r\n            var cl = \'");

            
            #line 540 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                 Write(ViewBag.CL);

            
            #line default
            #line hidden
WriteLiteral("\';\r\n            var ck = \'");

            
            #line 541 "..\..\Views\DesTask\SpecPlanInfo.cshtml"
                 Write(ViewBag.KC);

            
            #line default
            #line hidden
WriteLiteral("\';\r\n            if (cl == 1 || ck == 1) {\r\n                AddTask(specId, \"勘测工作大" +
"纲\",\'1\');\r\n                AddTask(specId, \"质量环境安全及技术交底\",\'2\');\r\n                A" +
"ddTask(specId, \"勘测成果\",\'3\');\r\n            }\r\n        }\r\n\r\n        // 渲染表格\r\n      " +
"  function tablebound(isRead, fatherIdData) {\r\n            if (isRead) {\r\n      " +
"          $(\"a[btnEdit][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").link" +
"button({iconCls: \'fa fa-info-circle fa-lg\'});\r\n                $(\"a[btnEdit][spe" +
"cId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n          " +
"  } else {\r\n                // 设置 任务编号 文本框\r\n                $(\"input[taskNumber]" +
"[specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").textbox({prompt: \'任务编号\'});\r" +
"\n                createTaskNumberBox($(\"input[taskNumber][specId=\'\"+fatherIdData" +
".TaskSpecId+\"\'][remark=\'0\']\"), fatherIdData.TaskSpecId);\r\n                $(\"inp" +
"ut[taskNumber][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\"" +
",\"1\");\r\n                // 设置 任务名称 文本框\r\n                $(\"input[taskName][specI" +
"d=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").textbox({prompt: \'任务名称\', required" +
": true});\r\n                createTaskNameBox($(\"input[taskName][specId=\'\"+father" +
"IdData.TaskSpecId+\"\'][remark=\'0\']\"), fatherIdData.TaskSpecId);\r\n                " +
"$(\"input[taskName][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").attr(\"rem" +
"ark\",\"1\");\r\n\r\n                $(\"input[dateStart][specId=\'\"+fatherIdData.TaskSpe" +
"cId+\"\'][remark=\'0\']\").datebox({validType:[\'dateISO\']});\r\n                $(\"inpu" +
"t[dateStart][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\",\"" +
"1\");\r\n                $(\"input[dateEnd][specId=\'\"+fatherIdData.TaskSpecId+\"\'][re" +
"mark=\'0\']\").datebox({validType:[\'dateISO\']});\r\n                $(\"input[dateEnd]" +
"[specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n      " +
"          $(\"a[btn][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").linkbutt" +
"on({iconCls: \'fa fa-trash fa-lg\'});\r\n                $(\"a[btn][specId=\'\"+fatherI" +
"dData.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n                $(\"a[btn" +
"Edit][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").linkbutton({iconCls: \'" +
"fa fa-info-circle fa-lg\'});\r\n                $(\"a[btnEdit][specId=\'\"+fatherIdDat" +
"a.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n                $(\"a[btnChan" +
"ge][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\").linkbutton({iconCls: \'fa" +
" fa-external-link fa-lg\'});\r\n                $(\"a[btnChange][specId=\'\"+fatherIdD" +
"ata.TaskSpecId+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n            }\r\n\r\n         " +
"   // 添加 校审人员配置面板\r\n            createTaskEmpSettingPlan(isRead, $(\"div[empPlan][" +
"specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\"), fatherIdData.TaskSpecId);\r\n" +
"            $(\"div[empPlan][specId=\'\"+fatherIdData.TaskSpecId+\"\'][remark=\'0\']\")." +
"attr(\"remark\",\"1\");\r\n        }\r\n\r\n        // 渲染行\r\n        function rowbound(isRe" +
"ad, fatherIdData) {\r\n            if (isRead) {\r\n                $(\"a[btnEdit][ro" +
"otId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").linkbutton({iconCls: \'fa fa-info-circl" +
"e fa-lg\'});\r\n                $(\"a[btnEdit][rootId=\'\"+fatherIdData.Id+\"\'][remark=" +
"\'0\']\").attr(\"remark\",\"1\");\r\n            } else {\r\n                // 设置 任务编号 文本框" +
"\r\n                $(\"input[taskNumber][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']" +
"\").textbox({prompt: \'任务编号\'});\r\n                createTaskNumberBox($(\"input[task" +
"Number][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\"), fatherIdData.TaskSpecId);\r\n" +
"                $(\"input[taskNumber][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\")" +
".attr(\"remark\",\"1\");\r\n                // 设置 任务名称 文本框\r\n                $(\"input[t" +
"askName][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").textbox({prompt: \'任务名称\', re" +
"quired:true,});\r\n                createTaskNameBox($(\"input[taskName][rootId=\'\"+" +
"fatherIdData.Id+\"\'][remark=\'0\']\"), fatherIdData.TaskSpecId);\r\n                $(" +
"\"input[taskName][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");" +
"\r\n\r\n                $(\"input[dateStart][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\'" +
"]\").datebox({validType:[\'dateISO\']});\r\n                $(\"input[dateStart][rootI" +
"d=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n                $(\"i" +
"nput[dateEnd][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").datebox({validType:[\'d" +
"ateISO\']});\r\n                $(\"input[dateEnd][rootId=\'\"+fatherIdData.Id+\"\'][rem" +
"ark=\'0\']\").attr(\"remark\",\"1\");\r\n                $(\"a[btn][rootId=\'\"+fatherIdData" +
".Id+\"\'][remark=\'0\']\").linkbutton({iconCls: \'fa fa-trash fa-lg\'});\r\n             " +
"   $(\"a[btn][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n  " +
"              $(\"a[btnEdit][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").linkbutt" +
"on({iconCls: \'fa fa-info-circle fa-lg\'});\r\n                $(\"a[btnEdit][rootId=" +
"\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n                $(\"a[b" +
"tnChange][rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").linkbutton({iconCls: \'fa f" +
"a-external-link fa-lg\'});\r\n                $(\"a[btnChange][rootId=\'\"+fatherIdDat" +
"a.Id+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n            }\r\n\r\n            //添加人员\r" +
"\n            createTaskEmpSettingPlan(isRead, $(\"div[empPlan][rootId=\'\"+fatherId" +
"Data.Id+\"\'][remark=\'0\']\"),fatherIdData.TaskSpecId);\r\n            $(\"div[empPlan]" +
"[rootId=\'\"+fatherIdData.Id+\"\'][remark=\'0\']\").attr(\"remark\",\"1\");\r\n        }\r\n\r\n " +
"       // 设置 任务编号 文本框\r\n        function createTaskNumberBox($div, SpecID) {\r\n   " +
"         console.log(\">>>>>>>\")\r\n            console.log($div);\r\n            $.e" +
"ach($div,function (i,e) {\r\n                var $item=$(this);\r\n                v" +
"ar $grid=$(\"#Spec_\"+SpecID);\r\n                var rootId=$item.attr(\"rootId\");\r\n" +
"                if ($grid.treegrid(\"find\",rootId)) {\r\n                    var ro" +
"otData=$grid.treegrid(\"find\",rootId);\r\n                    //console.log(rootDat" +
"a.TaskStatus);\r\n\r\n                    //var $textbox = $item.next();\r\n          " +
"          //$textbox.addClass(\"node-status-\" + rootData.TaskStatus);\r\n\r\n        " +
"            // 已完的设计节点，不能修改任务名称\r\n                    if (rootData.TaskStatus == " +
"_enum_Design_TaskStatus_已完成.toString()) {\r\n                        $item.textbox" +
"(\"disable\");\r\n                    } else {\r\n                        $item.textbo" +
"x(\"enable\");\r\n                    }\r\n                }\r\n            });\r\n       " +
" }\r\n\r\n\r\n        // 设置 任务名称 文本框\r\n        function createTaskNameBox($div, SpecID)" +
" {\r\n            $.each($div,function (i,e) {\r\n                var $item=$(this);" +
"\r\n                var $grid=$(\"#Spec_\"+SpecID);\r\n                var rootId=$ite" +
"m.attr(\"rootId\");\r\n                if ($grid.treegrid(\"find\",rootId)) {\r\n       " +
"             var rootData=$grid.treegrid(\"find\",rootId);\r\n                    //" +
"console.log(rootData.TaskStatus);\r\n\r\n                    var $textbox = $item.ne" +
"xt();\r\n                    $textbox.addClass(\"node-status-\" + rootData.TaskStatu" +
"s);\r\n\r\n                    // 正在进行或已完的设计节点，不能修改任务名称\r\n                    if (roo" +
"tData.TaskStatus == _enum_Design_TaskStatus_已完成.toString()) {\r\n                 " +
"       $item.textbox(\"disable\");\r\n                        $textbox.tooltip({\r\n  " +
"                          position: \'right\',\r\n                            conten" +
"t: \'<span style=\"color:#fff\">状态为【进行中】或【已完成】的节点无法更改任务名称</span>\',\r\n               " +
"             onShow: function() {\r\n                                $(this).toolt" +
"ip(\'tip\').css({\r\n                                    backgroundColor: \'#666\',\r\n " +
"                                   borderColor: \'#666\'\r\n                        " +
"        });\r\n                            }\r\n                        });\r\n       " +
"             } else {\r\n                        $item.textbox(\"enable\");\r\n       " +
"             }\r\n                }\r\n            });\r\n        }\r\n\r\n        // 添加 校" +
"审人员配置面板\r\n        function createTaskEmpSettingPlan(isRead, $div, SpecID) {\r\n    " +
"        $.each($div,function (i,e) {\r\n                var $item=$(this);\r\n      " +
"          var $grid=$(\"#Spec_\"+SpecID);\r\n                var rootId=$item.attr(\"" +
"rootId\");\r\n                if ($grid.treegrid(\"find\",rootId)) {\r\n               " +
"     var rootData=$grid.treegrid(\"find\",rootId);\r\n                    debugger;\r" +
"\n                    //console.log(JSON.parse(rootData.TaskFlowModelJson));\r\n   " +
"                 var jsonData=JSON.parse(rootData.TaskFlowModelJson).hasOwnPrope" +
"rty(\"root\")?(JSON.parse(rootData.TaskFlowModelJson).root.item):JSON.parse(rootDa" +
"ta.TaskFlowModelJson);\r\n                    var FlowNodeData=Enumerable.From(jso" +
"nData).OrderBy(function (x) { return x.rownum.toInt(); }).ToArray();\r\n          " +
"          $item.empty();\r\n                    if (isRead) {\r\n                   " +
"     JQ.DesFlow.show({\r\n                            Ctl:$item,\r\n                " +
"            FlowData:FlowNodeData,\r\n                            setNode: false\r\n" +
"                        });\r\n                    } else {\r\n                     " +
"   $.each(FlowNodeData,function (ic,ec) {\r\n                            //$(\"<spa" +
"n>\"+ec.FlowNodeName+\":</span>\").appendTo($item);\r\n                            cr" +
"eateTaskEmpSettingDrop(SpecID,ec,$item,rootId,(rootData.TaskStatus==undefined?0:" +
"rootData.TaskStatus));\r\n                        });\r\n                    }\r\n    " +
"            }\r\n            });\r\n        }\r\n\r\n        // 创建人员设定下拉列表\r\n        func" +
"tion createTaskEmpSettingDrop(SpecID,e,$item,rootId,taskStatus) {\r\n            /" +
"/获取资格人员\r\n            var EmpData=null;\r\n            if (SpecID == 0) {\r\n        " +
"        // 汇总的设计人员 = 项目负责人 + 各专业负可选责人 + 各专业设计人员\r\n                //if (e.FlowNod" +
"eTypeID == _enum_Design_NodeType_设计.toString()) {\r\n                //    // 获取项目" +
"负责人\r\n                //    var _pdata = [];\r\n                //    _pdata.push({" +
"\r\n                //        EmpID : _projEmpId,\r\n                //        EmpNa" +
"me : _projEmpName\r\n                //    });\r\n\r\n                //    // 获取专业负责人" +
" + 各专业设计人员，\r\n                //    var _sdata = Enumerable.From(_Qualification)\r" +
"\n                //        .Where(\"x=>x.QualificationSpecID!=-1&&(x.Qualificatio" +
"nValue=={0} || x.QualificationValue=={1})\".format(_enum_Design_NodeType_专业, _enu" +
"m_Design_NodeType_设计))\r\n                //        .Select(\"x=>{EmpID:x.EmpID,Emp" +
"Name:x.EmpName}\").ToArray();\r\n\r\n                //    // 合并上述人员\r\n               " +
" //    EmpData = Enumerable.From(_sdata).Union(_pdata)\r\n                //      " +
"  .Select(function(x){ return { EmpID: x.EmpID, EmpName: JQ.tools.CreateEmpNameW" +
"ithPY(x.EmpName)}})\r\n                //        .Distinct(\"x=>x.EmpID\")\r\n        " +
"        //        .OrderBy(\"x=>x.EmpName\").ToArray();\r\n                //} else " +
"{\r\n                    // 汇总的校审人员 = 所有专业可选校审人员\r\n                    EmpData = En" +
"umerable.From(_Qualification).Where(\"x=>x.QualificationSpecID==\" + SpecID + \"&&x" +
".QualificationValue==\" +_enum_Design_NodeType_审定 +\"\")\r\n                        ." +
"Select(function(x){ return { EmpID: x.EmpID, EmpName: JQ.tools.CreateEmpNameWith" +
"PY(x.EmpName)}})\r\n                        .Distinct(\"x=>x.EmpID\")\r\n             " +
"           .OrderBy(\"x=>x.EmpName\").ToArray();\r\n                //}\r\n           " +
" } else {\r\n                // 非汇总的设校审批人员默认从资格配置获取\r\n                EmpData = Enu" +
"merable.From(_Qualification).Where(\"x=>x.QualificationSpecID==\" + SpecID + \"&&x." +
"QualificationValue==\" +e.FlowNodeTypeID +\"\")\r\n                        .Select(fu" +
"nction(x){ return { EmpID: x.EmpID, EmpName: JQ.tools.CreateEmpNameWithPY(x.EmpN" +
"ame)}})\r\n                        .Distinct(\"x=>x.EmpID\")\r\n                      " +
"  .OrderBy(\"x=>x.EmpName\").ToArray();\r\n            }\r\n            // 合并之前配置人员，防止" +
"人员禁用后，下拉列表只显示数字，不显示人名的问题\r\n            if (e.FlowNodeEmpID != 0) {\r\n             " +
"   EmpData = Enumerable.From(EmpData).Union([{EmpID:e.FlowNodeEmpID.toInt(), Emp" +
"Name:JQ.tools.CreateEmpNameWithPY(e.FlowNodeEmpName)}]).Distinct(\"x=>x.EmpID\").T" +
"oArray(); //结果是两个结果集里面所有值，并自动去重\r\n            }\r\n\r\n            var $select= $(\"<s" +
"elect id=\\\"empDrop_\"+SpecID+\"_\"+e.ID+\"\\\" style=\\\"width:70px; margin-right:4px;\\\"" +
"></select>\");\r\n            $select.appendTo($item);\r\n            $select.combobo" +
"x({\r\n                valueField: \'EmpID\',\r\n                textField: \'EmpName\'," +
"\r\n                data: EmpData,\r\n                editable: true,//禁止模糊筛选，\r\n    " +
"            limitToList: true,//仅限于列表中\r\n                model: \'local\',\r\n       " +
"         width: \'110px\',\r\n                panelMaxHeight: \'360px\',\r\n            " +
"    required: true,\r\n                onChange: function (newValue, oldValue) {\r\n" +
"                    if ($select.oldValue == undefined) {\r\n                      " +
"  $select.oldValue = oldValue;\r\n                    }\r\n                },\r\n     " +
"           onSelect:function () {\r\n                    if (e.FlowNodeTypeID==_en" +
"um_Design_NodeType_设计.toString()) {\r\n                        var dataroot=$(\"#Sp" +
"ec_\"+SpecID).treegrid(\"find\",rootId);\r\n                        // 设计人员数据 同时 存储与行" +
"数据中 和 流程模板xml中，这里设计人员更改后先更改行数据中的字段\r\n                        dataroot.TaskEmpID=$" +
"(this).combobox(\"getValue\");\r\n                        dataroot.TaskEmpName=JQ.to" +
"ols.GetEmpNameWithoutPY($(this).combobox(\"getText\"));\r\n                    }\r\n  " +
"              },\r\n                filter: function(q, row){\r\n                   " +
" var _options = $(this).combobox(\'options\');\r\n                    return row[_op" +
"tions.textField].indexOf(q.toUpperCase()) > -1;\r\n                },\r\n           " +
"     onHidePanel : function() {\r\n                    var _options = $(this).comb" +
"obox(\'options\');\r\n                    var _data = $(this).combobox(\'getData\');/*" +
" 下拉框所有选项 */\r\n                    var _text = $(this).combobox(\'getText\');/* 用户输入" +
"的值 */\r\n                    var _value = \"0\";\r\n                    for (var i = 0" +
"; i < _data.length; i++) {\r\n                        if (_data[i][_options.textFi" +
"eld] == _text) {\r\n                            _value = _data[i][_options.valueFi" +
"eld];\r\n                            break;\r\n                        }\r\n          " +
"          }\r\n                    if(_value == \"0\") {\r\n                        if" +
" ($select.oldValue == \"\"){\r\n                            $(this).combobox(\'setTex" +
"t\', \"\");\r\n                        } else {\r\n                            $(this)." +
"combobox(\'setValue\', $select.oldValue);\r\n                        }\r\n            " +
"        } else {\r\n                        $(this).combobox(\'setValue\', _value);\r" +
"\n                    }\r\n                }\r\n            });\r\n\r\n            // 对Ea" +
"syUI的combo控件进行改造，增加颜色标识和文本标签\r\n            var $combo = $select.next();\r\n        " +
"    //$combo.addClass(\"combo-node node-status-\" + (e.FlowNodeTypeID == _enum_Des" +
"ign_NodeType_设计.toString() ? e.FlowNodeStatus : \'\')); // 这边配置的是模板，所以状态永远不变，所以不需要" +
"显示节点颜色标示\r\n            $combo.addClass(\"combo-node\");\r\n            $(\"<span NodeN" +
"ame class=\\\"bold\\\" style=\\\"line-height: 27px; padding: 0 4px; display: inline-bl" +
"ock; background-color: #eeeeee;\\\">\"+e.FlowNodeName+\"</span>\").prependTo($combo);" +
"\r\n\r\n            var $cbinput = $combo.find(\'input.textbox-text\');\r\n            $" +
"cbinput.css(\'width\',\'50px\')\r\n            $cbinput.bind(\'focus\',function(){\r\n    " +
"            //$drop.combobox(\'showPanel\');\r\n                $(this).select();\r\n " +
"           });\r\n\r\n            if (e.hasOwnProperty(\"FlowNodeEmpID\")&&e.FlowNodeE" +
"mpID!=0) {\r\n                $select.combobox(\"setValue\",e.FlowNodeEmpID);\r\n     " +
"       }\r\n\r\n            if (taskStatus==_enum_Design_TaskStatus_已完成.toString()) " +
"{\r\n                $select.combobox(\"disable\");\r\n                $combo.tooltip(" +
"{\r\n                    position: \'right\',\r\n                    content: \'<span s" +
"tyle=\"color:#fff\">状态为【已完成】的节点无法更改人员</span>\',\r\n                    onShow: functi" +
"on() {\r\n                        $(this).tooltip(\'tip\').css({\r\n                  " +
"          backgroundColor: \'#666\',\r\n                            borderColor: \'#6" +
"66\'\r\n                        });\r\n                    }\r\n                });\r\n  " +
"          }else {\r\n                // 正在进行或已完的设计节点，不能修改人员\r\n                if (e" +
".FlowNodeStatus == _enum_Design_FlowNodeStatus_未安排.toString() || e.FlowNodeStatu" +
"s == _enum_Design_FlowNodeStatus_已安排.toString()) {\r\n                    $select." +
"combobox(\"enable\");\r\n                } else {\r\n                    $select.combo" +
"box(\"disable\");\r\n                    $combo.tooltip({\r\n                        p" +
"osition: \'right\',\r\n                        content: \'<span style=\"color:#fff\">状态" +
"为【进行中】或【已完成】的节点无法更改人员，针对【进行中】的任务，<br />如果你真的想要更改人员，你可以用右侧的【移交】功能。</span>\',\r\n    " +
"                    onShow: function() {\r\n                            $(this).to" +
"oltip(\'tip\').css({\r\n                                backgroundColor: \'#666\',\r\n  " +
"                              borderColor: \'#666\'\r\n                            }" +
");\r\n                        }\r\n                    });\r\n                }\r\n     " +
"       }\r\n        }\r\n\r\n        // 添加普通任务\r\n        function AddTaskFather(SpecId)" +
" {\r\n            var item = $(\"#Spec_\"+SpecId).treegrid(\"getSelected\");\r\n        " +
"    if (item) {\r\n                $(\"#Spec_\"+SpecId).treegrid(\"unselect\",item.Id)" +
";\r\n            }\r\n            AddTask(SpecId);\r\n        }\r\n\r\n        // 添加子任务\r\n " +
"       function AddTaskChild(SpecId) {\r\n            var item = $(\"#Spec_\"+SpecId" +
").treegrid(\"getSelected\");\r\n            if (item==null) {\r\n                JQ.di" +
"alog.info(\"请选择一条任务！！！\");\r\n                return false;\r\n            }\r\n        " +
"    else if (checkRelation(item)) {\r\n                JQ.dialog.info(\"已有其它专业任务关联到" +
"本任务，所以无法在本任务下增加子任务。\");\r\n                return false;\r\n            }\r\n          " +
"  else {\r\n                AddTask(SpecId);\r\n            }\r\n        }\r\n\r\n        " +
"var newI = 1;\r\n        // 添加任务\r\n        function AddTask(SpecID,taskName,taskNum" +
"ber) {\r\n            debugger\r\n            var $SpecGrid =$(\"#Spec_\"+SpecID);\r\n  " +
"          var item = $SpecGrid.treegrid(\"getSelected\");\r\n            var SpecDat" +
"a=Enumerable.From(_SpecPlanData).Where(\"x=>x.TaskSpecId==\"+SpecID+\"&&x.TaskType=" +
"=1\").FirstOrDefault();\r\n            _tempTaskId--;\r\n            var addData={\r\n " +
"               Id: _tempTaskId ,\r\n                ProjId:_projID || 0,\r\n        " +
"        TaskGroupId:_taskGroupId || 0,\r\n                TaskNumber: \"\",\r\n       " +
"         TaskName:\"\",\r\n                DatePlanStart:\"\",\r\n                DatePl" +
"anFinish:\"\",\r\n                TaskSpecId:SpecID,\r\n                TaskType:0,\r\n " +
"               TaskStatus:-1,\r\n                iconCls: \"fa fa-dot-circle-o\"\r\n  " +
"          };\r\n            if (!item) {\r\n                //无层级\r\n                a" +
"ddData.TaskName = SpecID == 0 ? \"项目汇总\" : taskName == undefined ? \"设计任务\" : taskNa" +
"me;\r\n                addData.TaskNumber = SpecID == 0 ? \"项目汇总\" : taskNumber == u" +
"ndefined ? \"任务编号\" : taskNumber;\r\n                addData.TaskFlowModelJson=SpecD" +
"ata.TaskFlowModelJson;\r\n                addData.FlowId=SpecData.FlowId;\r\n       " +
"         addData.TaskParentId=SpecData.Id;\r\n                addData.OldFlowId=Sp" +
"ecData.FlowId;\r\n                addData.TaskNextFlowNodeId = 0;\r\n               " +
" addData.TaskOldEmpId=0;\r\n                addData.TaskLevel = 1;\r\n              " +
"  addData.TaskLevelType=0;//无层级、专业任务下的 level为1\r\n                $SpecGrid.treegr" +
"id(\"append\",{\r\n                    parent: SpecData.Id,\r\n                    dat" +
"a: [addData]\r\n                });\r\n            }\r\n            else {\r\n          " +
"      //获取父节点\r\n                var fatherDate=$SpecGrid.treegrid(\"find\",item.Id)" +
";\r\n                // TaskLevelType 层级类型：0 无层级 1 子层级 2 父层级\r\n                if (" +
"fatherDate.TaskLevelType==0) {\r\n                    //无层级 转 层级父\r\n               " +
"     fatherDate.OldTaskLevelType=fatherDate.TaskLevelType;\r\n                    " +
"fatherDate.TaskLevelType=2;\r\n                    $(\"div[rootId=\'\"+item.Id+\"\'][em" +
"pPlan]\").attr(\"remark\",\'0\');\r\n                    var flowDate= GetDesFlow(SpecI" +
"D,fatherDate.TaskLevelType);\r\n                    fatherDate.OldTaskFlowModelJso" +
"n=fatherDate.TaskFlowModelJson;//记录 旧数据\r\n                    fatherDate.TaskFlow" +
"ModelJson=flowDate.DesFlowNodeJson;//重新赋值流程\r\n                    fatherDate.Flow" +
"Id=flowDate.ID;\r\n                }\r\n                else if (fatherDate.TaskLeve" +
"lType==1) {\r\n                    //层级子 转 层级父\r\n                    fatherDate.Old" +
"TaskLevelType=fatherDate.TaskLevelType;\r\n                    fatherDate.TaskLeve" +
"lType=2;\r\n                    $(\"div[rootId=\'\"+item.Id+\"\'][empPlan]\").attr(\"rema" +
"rk\",\'0\');\r\n                    var flowDate= GetDesFlow(SpecID,fatherDate.TaskLe" +
"velType);\r\n                    fatherDate.OldTaskFlowModelJson=fatherDate.TaskFl" +
"owModelJson;//记录 旧数据\r\n                    fatherDate.TaskFlowModelJson=flowDate." +
"DesFlowNodeJson;//重新赋值流程\r\n                    fatherDate.FlowId=flowDate.ID;\r\n  " +
"              }\r\n                // 添加层级子\r\n                addData.TaskName = Sp" +
"ecID == 0 ? \"汇总任务\" : taskName == undefined ? \"设计任务\" : taskName;\r\n               " +
" addData.TaskLevel = fatherDate.TaskLevel + 1;\r\n                addData.TaskLeve" +
"lType=1;\r\n                var flowDate= GetDesFlow(SpecID,1);\r\n                a" +
"ddData.TaskFlowModelJson=flowDate.DesFlowNodeJson;\r\n                addData.Flow" +
"Id=flowDate.ID;\r\n                addData.OldFlowId=0;\r\n                addData.T" +
"askParentId=item.Id;\r\n                addData.TaskOldEmpId=0;\r\n                a" +
"ddData.TaskNextFlowNodeId = item.Id;\r\n\r\n                $SpecGrid.treegrid(\"appe" +
"nd\",{\r\n                    parent: item.Id,\r\n                    data: [addData]" +
"\r\n                });\r\n            }\r\n        }\r\n\r\n        // 设置关联任务\r\n        fu" +
"nction AddSummaryChild(SpecId) {\r\n            var item = $(\"#Spec_\"+SpecId).tree" +
"grid(\"getSelected\");\r\n            if (item==null) {\r\n                JQ.dialog.i" +
"nfo(\"请选择一条任务。\");\r\n                return false;\r\n            }\r\n            if (" +
"item.TaskLevelType == _enum_Design_TaskLevelType_层级父) {\r\n                JQ.dial" +
"og.info(\"不能在含有子任务的任务上关联任务。\");\r\n                return false;\r\n            }\r\n\r\n " +
"           var saveData = GetSaveData({\r\n                hasAllSpec: _taskSpecId" +
" == 0\r\n            });\r\n\r\n            if (saveData == null) return;\r\n           " +
" var _DialogdivId = JQ.dialog.dialog({\r\n                title: decodeURIComponen" +
"t(\"设置关联任务\"),\r\n                width: 700,\r\n                height: 600,\r\n       " +
"         JQID: \"SpecPlanInfoAddSummary\",\r\n                JQLoadingType: \"\",\r\n  " +
"              iconCls: \"fa fa-table\",\r\n                url: _webconfig.serverUrl" +
" + \'Design/DesTask/SpecPlanInfoAddSummary?TaskId={0}\'.format(item.Id),\r\n        " +
"        method: \'post\',\r\n                queryParams:{\r\n                    spec" +
"PlanData: JSON.stringify(saveData)\r\n                }\r\n            });\r\n        " +
"    // 对话框回调\r\n            window.top.window[\"_DialogCallback_\" + _DialogdivId] =" +
" function(getChecks) {\r\n                var arrChecks = Enumerable.From(getCheck" +
"s).Select(\"x => x.Id\").ToArray();\r\n\r\n                // 遍历各专业表格\r\n               " +
" $.each($(\"table[id^=\'Spec_\']\"),function () {\r\n                    var $grid=$(t" +
"his);\r\n                    var rowData = $grid.treegrid(\"getData\");\r\n           " +
"         // 遍历表格行，保存任务数据\r\n                    $.each(rowData,function (i,e) {\r\n " +
"                       var isRead = $(\"input[TaskName][rootId=\'\"+e.Id+\"\']\").size" +
"() == 0;\r\n                        if (arrChecks.isIndexOf(e.Id)) {\r\n            " +
"                if (e.TaskNextFlowNodeId != item.Id) {\r\n                        " +
"        e.TaskNextFlowNodeId = item.Id;\r\n                                $grid.t" +
"reegrid(\'refresh\', e.Id);\r\n                                rowbound(isRead, e);\r" +
"\n                            }\r\n                        } else if (e.TaskNextFlo" +
"wNodeId == item.Id) {\r\n                            e.TaskNextFlowNodeId = 0;\r\n  " +
"                          $grid.treegrid(\'refresh\', e.Id);\r\n                    " +
"        rowbound(isRead, e);\r\n                        }\r\n                    });" +
"\r\n                });\r\n            }\r\n        }\r\n\r\n        // 删除关联\r\n        func" +
"tion delRelation(taskId) {\r\n            $.each($(\"table[id^=\'Spec_\']\"),function " +
"() {\r\n                var $grid=$(this);\r\n                var rowData = $grid.tr" +
"eegrid(\"getData\");\r\n                // 遍历表格行，保存任务数据\r\n                $.each(rowD" +
"ata,function (i, e) {\r\n                    if (e.TaskNextFlowNodeId == taskId) {" +
"\r\n                        e.TaskNextFlowNodeId = 0;\r\n                        $gr" +
"id.treegrid(\'refresh\', e.Id);\r\n                        rowbound(e);\r\n           " +
"         }\r\n                });\r\n            });\r\n        }\r\n\r\n        // 删除任务\r\n" +
"        function delTask(SpecId, taskId) {\r\n            try {\r\n                i" +
"f (taskId>0) {\r\n                    JQ.dialog.confirm(\"你确定要删除嘛！！！\",function () {" +
"\r\n                        JQ.tools.ajax({\r\n                            url: _web" +
"config.serverUrl + \'Design/DesTask/SpecPlanInfoDelSpecPlanData?taskId=\' + taskId" +
",\r\n                            succesCollBack: function () {\r\n                  " +
"              // 清除与其他任务的关联\r\n                                delRelation(taskId)" +
";\r\n\r\n                                // 删除当前任务\r\n                                " +
"$(\"#Spec_\"+SpecId).treegrid(\"remove\",taskId);\r\n                            }\r\n  " +
"                      });\r\n                    });\r\n                }\r\n         " +
"       else {\r\n                    JQ.dialog.confirm(\"你确定要删除嘛！！！\",function () {\r" +
"\n                        // 清除与其他任务的关联\r\n                        delRelation(task" +
"Id);\r\n\r\n                        // 再删除当前任务，如果父任务的话还要改变父任务的层级及流程。\r\n              " +
"          var _parentNode=$(\"#Spec_\"+SpecId).treegrid(\"getParent\",taskId);\r\n    " +
"                    $(\"#Spec_\"+SpecId).treegrid(\"remove\",taskId);\r\n             " +
"           if (_parentNode!=null) {\r\n                            changeParentTas" +
"kLevelType(SpecId,_parentNode);\r\n                        }\r\n                    " +
"});\r\n                }\r\n\r\n            } catch (e) {\r\n                JQ.dialog.s" +
"how(\"删除出错啦！！！\");\r\n            }\r\n        }\r\n\r\n        // 改变父任务的层级及流程\r\n        fu" +
"nction changeParentTaskLevelType(SpecId,_parentNode) {\r\n            var _child=$" +
"(\"#Spec_\"+SpecId).treegrid(\"getChildren\",_parentNode.Id);\r\n            if (_chil" +
"d.length==0) {\r\n                _parentNode.TaskFlowModelJson=_parentNode.OldTas" +
"kFlowModelJson;\r\n                _parentNode.TaskLevelType=_parentNode.OldTaskLe" +
"velType;\r\n                createTaskEmpSettingPlan($(\"div[empPlan][specId=\'\"+Spe" +
"cId+\"\'][rootid=\'\"+_parentNode.Id+\"\']\"),SpecId)\r\n            }\r\n        }\r\n\r\n    " +
"    // 任务移交\r\n        function transferTask(SpecId,Id){\r\n            var title=$(" +
"\"input[taskName][specId=\'\"+SpecId+\"\'][rootid=\'\"+Id+\"\']\").textbox(\"getText\");\r\n  " +
"          var $div = $(\"<div id=\'dialogEmp\'></div>\")\r\n            $div.appendTo(" +
"window.top.$(\"body\"));\r\n            window.top.$(\"#dialogEmp\").dialog({\r\n       " +
"         title: \"[工作移交]\"+title,\r\n                width: 600,\r\n                he" +
"ight: 300,\r\n                iconCls:\'fa fa-external-link\',\r\n                clos" +
"ed: false,\r\n                cache: false,\r\n                modal: true,\r\n       " +
"         toolbar: [{\r\n                    text: \'替换\',\r\n                    iconC" +
"ls: \'fa fa-save\',\r\n                    onClick: function () {\r\n                 " +
"       return JQ.dialog.confirm(\"你确定要替换这些人员嘛?\",function () {\r\n                  " +
"          var rootData=$(\"#Spec_\"+SpecId).treegrid(\"find\",Id);\r\n                " +
"            var jsonData=JSON.parse(rootData.TaskFlowModelJson).hasOwnProperty(\"" +
"root\")?(JSON.parse(rootData.TaskFlowModelJson).root.item):JSON.parse(rootData.Ta" +
"skFlowModelJson);\r\n                            //var NewData=Enumerable.From(jso" +
"nData).Where(\"x=>x.FlowNodeTypeID==19\").ToArray();//获取设计\r\n                      " +
"      var NewData=Enumerable.From(jsonData).ToArray();\r\n                        " +
"    var postData=[];\r\n                            debugger;\r\n                   " +
"         if (NewData&&NewData.length>0) {\r\n                                $.eac" +
"h(NewData,function(root_Index,root_Item){\r\n                                    v" +
"ar dropId= window.top.$(\"#dialogEmp\").find(\"select[id$=\'_\"+root_Item.ID+\"\']\").at" +
"tr(\"id\");\r\n                                    var $drop=window.top.$(\"#\"+dropId" +
");\r\n                                    try {\r\n                                 " +
"       var NewEmpID=$drop.combobox(\"getValue\");\r\n                               " +
"         if (root_Item.FlowNodeEmpID!=NewEmpID) {\r\n                             " +
"               postData.push({\r\n                                                " +
"ID:root_Item.ID,\r\n                                                fromEmpId:root" +
"_Item.FlowNodeEmpID,\r\n                                                toEmpId:Ne" +
"wEmpID,\r\n                                                ItemType:root_Item.Flow" +
"NodeTypeID==\"19\"?3:4,\r\n                                                TaskId:Id" +
",\r\n                                                FlowNodeTypeID:root_Item.Flow" +
"NodeTypeID,\r\n                                            });\r\n                  " +
"                      }\r\n                                    } catch (e) {\r\n\r\n  " +
"                                  }\r\n                                })\r\n       " +
"                     }\r\n\r\n                            //执行数据库操作\r\n               " +
"             if (postData.length>0) {\r\n                                JQ.tools." +
"ajax({\r\n                                    url: _webconfig.serverUrl + \'Design/" +
"DesTask/SpecPlanInfoTaskTransfer\',\r\n                                    data: { " +
"postData: JSON.stringify(postData) },\r\n                                    succe" +
"sCollBack: function (backJson) {\r\n                                        //var " +
"$empPlan=$(\"div[empPlan][specId=\'\"+SpecId+\"\'][rootid=\'\"+Id+\"\']\");\r\n             " +
"                           //if (postData.length>0) {\r\n                         " +
"               //    $.each(postData,function(ip,ep){\r\n                         " +
"               //        var dropItem=$empPlan.find(\"select[id$=\'_\"+ep.ID+\"\']\");" +
"\r\n                                        //        $(dropItem).combobox(\"setVal" +
"ue\",ep.toEmpId);\r\n                                        //    })\r\n            " +
"                            //}\r\n                                        window." +
"location.href = tabs[tabId] + \"&time=\" + (new Date()).getTime();\r\n              " +
"                          window.top.$(\"#dialogEmp\").dialog(\"close\");\r\n         " +
"                           }\r\n                                });\r\n             " +
"               }else {\r\n                                JQ.dialog.warning(\"各个任务点" +
"的人员没有更改！\");\r\n                            }\r\n\r\n                        })\r\n      " +
"              }\r\n                },{\r\n                    text:\'关闭\',\r\n          " +
"          iconCls: \'fa fa-close\',\r\n                    onClick:function () {\r\n  " +
"                      window.top.$(\"#dialogEmp\").dialog(\"close\");\r\n             " +
"       }\r\n                }],\r\n                onOpen:function () {\r\n           " +
"         $(\"<span>任务移交:</span>\").appendTo(window.top.$(\"#dialogEmp\"));\r\n        " +
"            //人员加载\r\n                    var $empPlan=$(\"div[empPlan][specId=\'\"+S" +
"pecId+\"\'][rootid=\'\"+Id+\"\']\");\r\n                    var dropItems=$empPlan.find(\"" +
"select[id^=\'empDrop_\"+SpecId+\"\']\");\r\n                    $.each(dropItems,functi" +
"on(dropIndex,dropItem){\r\n                        var oldDropID=$(dropItem).attr(" +
"\"id\");//下拉控件ID\r\n                        var opt=$(dropItem).combobox(\"options\");" +
"\r\n                        var spanTip=$(dropItem).next().find(\"span[NodeName]\");" +
"//节点名称\r\n                        var oldValue=$(dropItem).combobox(\"getValue\");//" +
"选中值\r\n                        var $Newselect= $(\"<select id=\\\"dialogEmp_\"+oldDrop" +
"ID+\"\\\" style=\\\"width:70px; margin-right:4px;\\\"></select>\");\r\n                   " +
"     $Newselect.appendTo(window.top.$(\"#dialogEmp\"));\r\n                        w" +
"indow.top.$(\"#dialogEmp_\"+oldDropID).combobox({\r\n                            val" +
"ueField:opt.valueField,\r\n                            textField:opt.textField,\r\n " +
"                           data: opt.data,\r\n                            width: o" +
"pt.width,\r\n                            panelMaxHeight:opt.panelMaxHeight,\r\n     " +
"                       required: opt.required,\r\n                            edit" +
"able:opt.editable,\r\n                        });\r\n                        window." +
"top.$(\"#dialogEmp_\"+oldDropID).combobox(\"setValue\",oldValue);\r\n                 " +
"       var NewTip=spanTip[0];\r\n                        $(\"<span NodeName style=\\" +
"\"line-height: 27px; padding-left:4px;\\\">\"+$(NewTip).text()+\"</span>\").prependTo(" +
"window.top.$(\"#dialogEmp_\"+oldDropID).next());\r\n                        window.t" +
"op.$(\"#dialogEmp_\"+oldDropID).next().css({\"margin-right\":\"10px\"});\r\n            " +
"            //var $combo = $select.next();\r\n                        //$combo.add" +
"Class(\"combo-node node-status-\" + e.FlowNodeStatus);\r\n                        //" +
"$(\"<span NodeName style=\\\"line-height: 27px; padding-left:4px;\\\">\"+e.FlowNodeNam" +
"e+\":</span>\").prependTo($combo);\r\n                    });\r\n                },\r\n " +
"               onClose:function () {\r\n                    window.top.$(\"#dialogE" +
"mp\").remove();\r\n                }\r\n            });\r\n        }\r\n\r\n        // 查看任务" +
"\r\n        function showTaskInfo(SpecId,Id) {\r\n            var rootData=$(\"#Spec_" +
"\"+SpecId).treegrid(\"find\",Id);\r\n\r\n            JQ.dialog.dialog({\r\n              " +
"  title: rootData.TaskName,\r\n                url: _webconfig.serverUrl + \'Design" +
"/DesTask/TaskInfo?Id=\'+Id,\r\n                width: \'1200\',\r\n                heig" +
"ht: \'900\',\r\n                toolbar:null,\r\n                //JQID: \'TaskPerson\'," +
"\r\n                //JQLoadingType: \'datagrid\',\r\n                iconCls: \'fa fa-" +
"list\',\r\n            });\r\n        }\r\n\r\n        // 保存任务人员配置\r\n        function save" +
"TaskEmpSetting($div,Node) {\r\n            var NodeJson = Node.TaskFlowModelJson;\r" +
"\n            var jsonData=JSON.parse(NodeJson).hasOwnProperty(\"root\")?(JSON.pars" +
"e(NodeJson).root.item):JSON.parse(NodeJson);\r\n            if ($div&&jsonData.len" +
"gth>0) {\r\n                $.each(jsonData,function(i,e){\r\n                    $t" +
"hisselect=$div.find(\"select[id$=\'_\"+e.ID+\"\']\");\r\n                    e.FlowNodeE" +
"mpID=$thisselect.combobox(\"getValue\")==null?0:$thisselect.combobox(\"getValue\");\r" +
"\n                    e.FlowNodeEmpName=$thisselect.combobox(\"getText\")==null?0:J" +
"Q.tools.GetEmpNameWithoutPY($thisselect.combobox(\"getText\"));\r\n                 " +
"   if (e.FlowNodeStatus == 0) {\r\n                        // 节点状态: 0 未安排（灰） 1 已安排" +
"（黄） 2 进行中（绿色） 3 完成（蓝色） 4 停止（红色） 5 回退（橙色）\r\n                        if (Node.TaskS" +
"pecId != 0 && Node.TaskLevelType != _enum_Design_TaskLevelType_层级父 && e.FlowNode" +
"TypeID == _enum_Design_NodeType_设计.toString()) {\r\n                            e." +
"FlowNodeStatus = 2;\r\n                        } else {\r\n                         " +
"   e.FlowNodeStatus = 1;\r\n                        }\r\n                    }\r\n    " +
"            })\r\n            }\r\n            return jsonData;\r\n        }\r\n\r\n      " +
"  // 获取要保存的任务数据\r\n        function GetSaveData(params) {\r\n            params = $." +
"extend({\r\n                hasAllSpec: false\r\n            }, params);\r\n\r\n        " +
"    var saveData=[];\r\n            var result=true;\r\n            // 首先保存专业节点信息\r\n " +
"           var SpecArray=Enumerable.From(_SpecPlanData).Where(\"x=>x.TaskType==1\"" +
").ToArray();\r\n            $.each(SpecArray,function (index,data) {\r\n            " +
"    //data.TaskFlowModel=\"\";\r\n                saveData.push(data);\r\n            " +
"});\r\n            // 遍历各专业表格\r\n            $.each($(\"table[id^=\'Spec_\']\"),function" +
" (i,e) {\r\n                if (!result) {\r\n                    return false;\r\n   " +
"             }\r\n                var $grid=$(this);\r\n                var rowData=" +
"$grid.treegrid(\"getData\");\r\n                // 遍历表格行，保存任务数据\r\n                $.e" +
"ach(rowData,function (i,e) {\r\n                    if (!result) {\r\n              " +
"          return false;\r\n                    }\r\n                    if ($(\"input" +
"[TaskName][rootId=\'\"+e.Id+\"\']\").size() == 0) {\r\n                        if (para" +
"ms.hasAllSpec) {\r\n                            // 阶段汇总设置人员，指定汇总任务关联某专业任务时，需要修改那个任" +
"务的父任务id，假设汇总人员没有那个专业的配置权，\r\n                            // 这时问题就来了，由于没有权限界面上设定好的专" +
"业内容任务的父Id无法保存，为了解决这个问题，当汇总人员提交专业策划保存时，\r\n                            // 会把所以专业的数据" +
"都带过来，但是汇总人员没权限设置的专业里的任务的TaskFlowModelJson属性我都会赋值为空，以示区别。\r\n                      " +
"      // 这类任务只保持父任务Id，其他任务信息都不修改。\r\n                            var eClone = $.ex" +
"tend({}, e); // 不破坏表格行数据，克隆一个对象\r\n                            eClone.TaskFlowMode" +
"l = \"\";\r\n                            eClone.TaskFlowModelJson = \"\";\r\n           " +
"                 saveData.push(eClone);\r\n                        }\r\n            " +
"            return false;\r\n                    }\r\n                    if (!check" +
"TaskValist(e.Id)) {\r\n                        result=false;\r\n                    " +
"    return false;\r\n                    }\r\n\r\n                    //遍历任务\r\n        " +
"            var rootData=$grid.treegrid(\"find\",e.Id);\r\n                    rootD" +
"ata.TaskNumber=$(\"input[TaskNumber][rootId=\'\"+e.Id+\"\']\").textbox(\"getValue\");\r\n " +
"                   rootData.TaskName=$(\"input[TaskName][rootId=\'\"+e.Id+\"\']\").tex" +
"tbox(\"getValue\");\r\n                    rootData.DatePlanStart=$(\"input[dateStart" +
"][rootId=\'\"+e.Id+\"\']\").datetimebox(\"getValue\");\r\n                    rootData.Da" +
"tePlanFinish=$(\"input[dateEnd][rootId=\'\"+e.Id+\"\']\").datetimebox(\"getValue\");\r\n  " +
"                  //rootData.FlowId=rootData.FlowId;\r\n                    //root" +
"Data.Id=rootData.Id;\r\n                    //rootData.ProjId=rootData.ProjId;\r\n  " +
"                  //rootData.TaskEmpID=rootData.TaskEmpID;\r\n                    " +
"//rootData.TaskFlowModel=\"\";\r\n                    rootData.TaskFlowModelJson=JSO" +
"N.stringify(saveTaskEmpSetting($(\"div[empPlan][rootId=\'\"+e.Id+\"\']\"),rootData));\r" +
"\n                    saveData.push(rootData);\r\n                    var childNode" +
"=$grid.treegrid(\"getChildren\",e.Id);\r\n                    $.each(childNode,funct" +
"ion (ic,node) {\r\n                        if (!checkTaskValist(node.Id)) {\r\n     " +
"                       result=false;\r\n                            return false;\r" +
"\n                        }\r\n                        var rootDataChild=$grid.tree" +
"grid(\"find\",node.Id);\r\n                        rootDataChild.TaskNumber=$(\"input" +
"[TaskNumber][rootId=\'\"+node.Id+\"\']\").textbox(\"getValue\");\r\n                     " +
"   rootDataChild.TaskName=$(\"input[TaskName][rootId=\'\"+node.Id+\"\']\").textbox(\"ge" +
"tValue\");\r\n                        rootDataChild.DatePlanStart=$(\"input[dateStar" +
"t][rootId=\'\"+node.Id+\"\']\").datetimebox(\"getValue\");\r\n                        roo" +
"tDataChild.DatePlanFinish=$(\"input[dateEnd][rootId=\'\"+node.Id+\"\']\").datetimebox(" +
"\"getValue\");\r\n                        rootDataChild.TaskFlowModel=\"\";\r\n         " +
"               rootDataChild.TaskFlowModelJson=JSON.stringify(saveTaskEmpSetting" +
"($(\"div[empPlan][rootId=\'\"+node.Id+\"\']\"),rootDataChild));\r\n                     " +
"   saveData.push(rootDataChild);\r\n                    });\r\n                });\r\n" +
"            })\r\n            if (!result) {\r\n                JQ.dialog.show(\"验证失败" +
"！！！\");\r\n                return null;\r\n            }\r\n            return saveData" +
";\r\n        }\r\n\r\n        // 保存专业策划\r\n        function SaveSpecPlanInfo() {\r\n      " +
"      debugger;\r\n            var saveData=GetSaveData({\r\n                hasAllS" +
"pec: _taskSpecId == 0\r\n            });\r\n            if (saveData==null) return;\r" +
"\n            try {\r\n                debugger;\r\n                //window.top.$.me" +
"ssager.progress();\r\n                JQ.tools.ajax({\r\n                    url: _w" +
"ebconfig.serverUrl + \'Design/DesTask/SpecPlanInfoSaveSpecPlanData?taskGroupId={0" +
"}\'.format(_taskGroupId),\r\n                    data: {SpecPlanData:JSON.stringify" +
"(saveData)},\r\n                    succesCloseProgress: false,\r\n                 " +
"   progressWith: window,\r\n                    succesCollBack: function (data) {\r" +
"\n                        window.location.href = tabs[tabId] + \"&time=\" + (new Da" +
"te()).getTime();\r\n                    }\r\n                });\r\n            } catc" +
"h (e) {\r\n                //window.top.$.messager.progress(\'close\');\r\n           " +
" }\r\n        }\r\n\r\n        // 查看项目进度\r\n        function ShowProjectProgress(){\r\n   " +
"         JQ.dialog.dialogIframe({\r\n                title: \"项目进度\",\r\n             " +
"   url: _webconfig.serverUrl + \'Design/DesTask/ProjectProgressInfo?projID={0}&ta" +
"skGroupId={1}\'.format(_projID, _taskGroupId),\r\n                width: 1200,\r\n   " +
"             height: 900\r\n            });\r\n        };\r\n\r\n        // 返回上一页面\r\n    " +
"    function GoToBackPage() {\r\n            //window.parent.changeTabId(tabId - 1" +
");\r\n            window.location.href = tabs[tabId - 1] + \"&time=\" + (new Date())" +
".getTime();\r\n        }\r\n\r\n        $(function() {\r\n            // 导航栏点击\r\n        " +
"    $(\".pageheader li\").each(function(i, li) {\r\n                if (tabs[i].toLo" +
"werCase().indexOf(window.location.pathname.toLowerCase()) > -1) tabId = i;\r\n    " +
"            $(li).click(function() {\r\n                    //window.parent.change" +
"TabId(i);\r\n                    window.location.href = tabs[i] + \"&time=\" + (new " +
"Date()).getTime();\r\n                });\r\n            });\r\n\r\n            // 页面载入后" +
"，设置步骤导航，强调当前页面节点，并处理前后节点状态\r\n            $(\".pageheader li\").each(function(i, li)" +
" {\r\n                var $li = $(li);\r\n                var isShow = true;\r\n      " +
"          switch(i){\r\n                    case 0:\r\n                        isSho" +
"w = _mainTabsUsed.PlanTableList;\r\n                        break;\r\n              " +
"      case 1:\r\n                        isShow = _mainTabsUsed.ProjectPlanList;\r\n" +
"                        break;\r\n                    case 2:\r\n                   " +
"     isShow = _mainTabsUsed.ExchPlanList;\r\n                        break;\r\n     " +
"               case 3:\r\n                        isShow = _mainTabsUsed.SpecPlanL" +
"ist;\r\n                        break;\r\n                    case 4:\r\n             " +
"           isShow = _mainTabsUsed.ProjGanttList;\r\n                        break;" +
"\r\n                }\r\n                $li.toggle(isShow);\r\n                if (is" +
"Show) tabNum++;\r\n                if (i < tabId) {\r\n                    $li.addCl" +
"ass(\"visited\");\r\n                    $li.find(\".small-tag\").html(\'<i class=\"fa f" +
"a-check\" aria-hidden=\"true\"></i>\');\r\n                } else if (i == tabId) {\r\n " +
"                   $li.addClass(\"active\");\r\n                    $li.find(\".small" +
"-tag\").html(tabNum);\r\n                } else {\r\n                    $li.find(\".s" +
"mall-tag\").html(tabNum);\r\n                }\r\n            });\r\n\r\n            //显示" +
"专业面板\r\n            createSpecPlan();\r\n\r\n        });\r\n\r\n    </script>\r\n\r\n");

});

        }
    }
}
#pragma warning restore 1591
