@{
    Layout = "~/Areas/Core/Views/Mobile/_Layout.cshtml";
}

@using JQ.Web;
@model DataModel.Models.IsoGCCLTJD

@section head {
    <style type="text/css">
    .aui-btn {
        padding: 10px 15px;
        font-size: 13px;
    }

    .aui-btn-row:after {
        border: 0;
    }
    .p-15{
        padding:15px;
    }


    .set-disabled {
        pointer-events: none !important
    }

        .error {
            color: red;
            font-size: 14px;
        }

    .hidden {
        display: none;
    }

    .aui-input-hook {
        line-height: 34px;
        text-align: left;
        padding-left: 20px;
        background: #efefef;
    }

    .aui-display-hook {
        display: none;
        width: 30%;
        float: right;
        font-size: 13px;
        line-height: 33px;
        margin-right: 6px;
        padding: 3px 6px;
    }

    .aui-input-width {
        width: 98%;
    }

    .hiddenShow {
        height: 0;
    }

    .aui-input-row label.aui-input-addon {
        min-width: 90px;
    }

    .set-selected-icon select {
        float: right;
        margin-right: 5px;
        border: 0;
        margin-bottom: 0;
    }

    .set-selected-icon i {
        position: absolute;
        right: 25px;
        top: 15px;
    }
    .aui-input-row-position {
        position: relative;
        display: table;
        padding: 6px 0;
    }

    .aui-input-row label.aui-input-addon {
        font-size: 14px;
    }

    .jq-text-disabled {
        color: #898787;
        width: 98%;
        pointer-events: none;
        background-color: #efefef !important;
        border: 0;
        font-size: 13px;
    }
    .aui-input-check-disable {
        font-size: 12px !important;
        font-weight: normal !important;
    }

    .aui-input-check-disable label {
        line-height: 45px;
        margin-right: 15px;
    }

        .aui-input-check-disable input[type="checkbox"], .aui-input-check-disable input[type="radio"] {
            width: auto;
            margin: 0 5px 0 0;
            line-height: 45px;
        }
</style>
}

@section Body_Content{
    <div class="aui-content">
        <form id="IsoGCCLTJDForm" class="aui-form">
            <div class="p-15">
               表 <label>@Model.TableNumber</label><input type="hidden" name="TableNumber" value="@Model.TableNumber" />
                <br />编号 <input id="Number" name="Number" type="text" class="aui-input" style="display:inline;min-width: 60px;max-width: 60%;border: 1px solid #dbdbdb; border-radius: 6px;padding: 3px 6px;margin:0 3px;text-align:center;" class="form-control" validType="length[0,200]" value="@Model.Number" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;项目编号</label>
                <input type="hidden" id="Id" name="Id" value="@Model.Id" />
                <input name="ProjNumber" id="ProjNumber" type="hidden" class="aui-input" value="@Model.ProjNumber" style="width:60%;margin-right:15px;text-overflow: ellipsis;" />
                <div class="aui-input-block">@Model.ProjNumber</div>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;项目名称</label>
                <input type="hidden" id="ProjID" name="ProjID" value="@Model.ProjID" />
                <input name="ProjName" id="ProjName" type="hidden" class="aui-input" value="@Model.ProjName" />
                <div class="aui-input-block">@Model.ProjName</div>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;阶段名称</label>
                <input name="ProjPhaseName" id="ProjPhaseName" type="hidden" class="aui-input" value="@Model.ProjPhaseName" />
                <input type="hidden" name="ProjPhaseId" id="ProjPhaseId" value="@Model.ProjPhaseId" />
                <div class="aui-input-block">@Model.ProjName</div>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;成果交付日期</label>
                <input type="date" id="EngCGJFRQ" name="EngCGJFRQ" class="aui-input" value="@Model.EngCGJFRQ.ToString("yyyy-MM-dd")" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;工程地点</label>
                <input type="text" id="EngGCDD" name="EngGCDD" class="aui-input" value="@Model.EngGCDD" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;顾客</label>
                <input id="CustID" name="CustID" style="width:98%;" type="hidden" />
                <input id="CustName" name="CustName" type="hidden"  class="aui-input" value="@Model.CustName"  >
                <div class="aui-input-block" id="CustNameText" style="width:63%;display:inline-block">@Model.CustName</div>
                <input type="button" id="CustomerBtn" namne="CustomerBtn" class="aui-btn aui-btn-block aui-btn-success p-0" value="选择业主" style="width:32%;float:right;margin-right:8px;" onclick="selectCustName();" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;顾客联系人</label>
                <input id="CustLinkId" name="CustLinkId" style="width:98%;" type="hidden" />
                <input id="CustLinkManName" name="CustLinkManName" type="text" class="aui-input" value="@Model.CustLinkManName">
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;顾客联系电话</label>
                <input id="CustLinkManTel" name="CustLinkManTel" type="text" class="aui-input" value="@Model.CustLinkManTel">
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;设计人</label>
                <input id="EngSJRId" name="EngSJRId" class="easyui-combobox" type="hidden" value="@Model.EngSJRId" />
                <input id="EngSJRIdName" name="EngSJRIdName" class="easyui-combobox" type="hidden" value="@Model.EngSJR" />
                <input type="text" id="EngSJR" name="EngSJR" class="aui-input" value="@Model.EngSJR" style="width:63%;"/>
                <input type="button" id="useLeaderBtn" namne="useLeaderBtn" class="aui-btn aui-btn-block aui-btn-success p-0" value="选择人员" style="width:32%;float:right;margin-right:8px;" onclick="SetUseEmpBegin('EngSJRId',0);" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;设计人电话</label>
                <input type="text" id="EngSJRDH" name="EngSJRDH" class="aui-input" value="@Model.EngSJRDH" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;规划定线内容</label>
                <textarea rows="6" name="CHCGYQ" id="CHCGYQ" style="width:98%;" class="aui-input" data-options="multiline:true" validType="length[0,500]">@Model.CHCGYQ</textarea>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;纵断图</label>
                <textarea rows="6" name="CHCGYQZDT" id="CHCGYQZDT" style="width:98%;" class="aui-input" data-options="multiline:true" validType="length[0,500]">@Model.CHCGYQZDT</textarea>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;横断图</label>
                <textarea rows="6" name="CHCGYQHDT" id="CHCGYQHDT" style="width:98%;" class="aui-input" data-options="multiline:true" validType="length[0,500]">@Model.CHCGYQHDT</textarea>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;调查项目</label>
                <textarea rows="6" name="GCDCXM" id="GCDCXM" style="width:98%;" class="aui-input" data-options="multiline:true" validType="length[0,500]">@Model.GCDCXM</textarea>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;调查成果要求</label>
                <textarea rows="6" name="GCDCYQ" id="GCDCYQ" style="width:98%;" class="aui-input" data-options="multiline:true" validType="length[0,500]">@Model.GCDCYQ</textarea>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;成果特殊要求</label>
                <textarea rows="6" name="CGTSYQ" id="CGTSYQ" style="width:98%;" class="aui-input" data-options="multiline:true" validType="length[0,500]">@Model.CGTSYQ</textarea>
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;项目名称</label>
                <input id="EngineeringId" name="EngineeringId" type="hidden" value="@Model.EngineeringId" />
                @*<input id="EngineeringName" name="EngineeringName" class="aui-input" type="hidden" value="@Model.EngineeringName" />*@
                <textarea rows="1" name="EngineeringName" id="EngineeringName" style="width:60%;overflow:auto;" class="aui-input">@Model.EngineeringName</textarea>
                @*<div class="aui-input-block">@Model.EngineeringName</div>*@
                <input type="button" id="selectProjNameBtn" namne="selectProjNameBtn" class="aui-btn aui-btn-block aui-btn-success p-0" style="width:32%;float:right;margin-right:6px;" onclick="SetProjectSelectBegin();" value="项目选择" />
            </div>
            <div class="aui-input-row">
                <label class="aui-input-addon">&nbsp;&nbsp;项目编号</label>
                <input id="EngineeringNumber" name="EngineeringNumber" type="text" class="aui-input" value="@Model.EngineeringNumber" />
               
            </div>
            <div class="aui-dialog aui-hidden" id="dialog" style="top:50%;">
                <div class="aui-dialog-header">选择业主名称</div>
                <div class="aui-dialog-body aui-text-left">
                    <div class="aui-card aui-noborder" style="margin-bottom:0;">

                        <ul class="aui-list-view aui-self-list-view" id="gridList" style="max-height:250px;overflow-y:auto;margin-bottom:0;"></ul>
                        <!--模板-->
                        <script id="listTpl" type="text/x-dot-template">
                            {{~it:appendInfoData:index}}
                            <li class="aui-list-view-cell aui-im" tapmode data-uid="{{=appendInfoData.Id}}" style="padding:5px;">
                                <div class="radio" style="margin-top:0;margin-bottom:5px;">
                                    <input type="hidden" name="optionsRadios" id="{{=appendInfoData.Id}}" value="{{=appendInfoData.Id}}" />
                                    <input type="radio" name="optionsRadios" id="{{=appendInfoData.Id}}" value="{{=appendInfoData.Id}}_{{=appendInfoData.CustName}}" />
                                </div>
                                <div class="aui-img-body">
                                    <div style="margin-bottom: 5px;">
                                        <label style="display:inline">{{=appendInfoData.CustName == '' ? '未填写': appendInfoData.CustName}}</label>
                                    </div>
                                </div>
                            </li>
                            {{~}}
                        </script>
                    </div>
                </div>

                <div class="aui-dialog-footer">
                    <div class="aui-dialog-btn aui-text-danger" tapmode onclick="cancel()">取消</div>
                    <div class="aui-dialog-btn aui-text-info" tapmode onclick="confirm()">确定</div>
                </div>
            </div>
            @*<div class="aui-input-row">
                <div class="aui-btn aui-btn-block aui-btn-success p-0" onclick="validateFormBegin()">提交</div>
            </div>*@
        </form>
    </div>
    <script type="text/javascript">

        $(function () {
            if (window.JinQuMobile == undefined) {
                //initFormBegin(JSON.stringify({
                //    "Result": true,
                //    "Message": null,
                //    "NodeName": null,
                //    //"AllowEditControls": "ColAttVal1;btnChooseProject;ProjIDName;Number;ProjID;Words;ConstructUnit;SupplyUnit;FormDate;ColAttVal2;ModifyContent;DesignName;FormNote;DesChangeUpload;ColAttVal3;ProjName;DesignReason;ColAttVal4",
                //    "SignControls": "DesignName(签名)",
                //    "AllowEditControls":"{}"

                //}));
                //initFormBegin();
            }

        })
        //页面初始化
        function initFormBegin(params) {
           //alert(params)
            //去除换行
            //alert(window.location.href)
            params = params.replace(/[\r\n]/g, "");
            params = params.replace(/\s/g, "");
            var paramsObj = JSON.parse(params);


            //按钮替换
            paramsObj.AllowEditControls = paramsObj.AllowEditControls || '-';
            paramsObj.AllowEditControls = paramsObj.AllowEditControls
                .replace('CustID', 'CustomerBtn')
                .replace('EngSJRId', 'useLeaderBtn')
                .replace('EngineeringName','selectProjNameBtn');

            //清除时间审批时，默认为1900-01-01改为空
            var EngCGJFRQ = $('#EngCGJFRQ').val();;
            if ((EngCGJFRQ == '1900-01-01')) {
                $('#EngCGJFRQ').val('');
            }

             //设置表单不可编辑样式及只读
            $('form :input').addClass('jq-text-disabled').attr("readonly", "readonly");
            DomUtil.setCtrlsReadonly(paramsObj.AllowEditControls, document.getElementById('IsoGCCLTJDForm'));

            //规划定线内容，替换换行符
            var CHCGYQValue = $('#CHCGYQ').val();
            CHCGYQValue = CHCGYQValue.replace(/[\r\n]/g, "")
            $('#CHCGYQ').val(CHCGYQValue);

            //纵断图，替换换行符
            var CHCGYQZDTValue = $('#CHCGYQZDT').val();
            CHCGYQZDTValue = CHCGYQZDTValue.replace(/[\r\n]/g, "")
            $('#CHCGYQZDT').val(CHCGYQZDTValue);

            //横断图，替换换行符
            var CHCGYQHDTValue = $('#CHCGYQHDT').val();
            CHCGYQHDTValue = CHCGYQHDTValue.replace(/[\r\n]/g, "")
            $('#CHCGYQHDT').val(CHCGYQHDTValue);

            //调查项目，替换换行符
            var GCDCXMValue = $('#GCDCXM').val();
            GCDCXMValue = GCDCXMValue.replace(/[\r\n]/g, "")
            $('#GCDCXM').val(GCDCXMValue);

            //调查成果要求，替换换行符
            var GCDCYQValue = $('#GCDCYQ').val();
            GCDCYQValue = GCDCYQValue.replace(/[\r\n]/g, "")
            $('#GCDCYQ').val(GCDCYQValue);

            //成果特殊要求，替换换行符
            var CGTSYQValue = $('#CGTSYQ').val();
            CGTSYQValue = CGTSYQValue.replace(/[\r\n]/g, "")
            $('#CGTSYQ').val(CGTSYQValue);


            // $('#CHCGYQ,#CHCGYQZDT,#CHCGYQHDT,#GCDCXM,#GCDCYQ,#CGTSYQ').removeClass('jq-text-disabled').attr("readonly", "readonly")
            // $("#CHCGYQ,#CHCGYQZDT,#CHCGYQHDT,#GCDCXM,#GCDCYQ,#CGTSYQ").css({
            //    overflow: 'auto',
            //    background: '#efefef',
            //    color: '#898787'
            //})


            if (((paramsObj.AllowEditControls).indexOf('CHCGYQ')) != -1) {
                $("#CHCGYQ").removeClass('jq-text-disabled')
                $("#CHCGYQ").css({
                    overflow: 'auto',
                })
            }
            
          
            if (((paramsObj.AllowEditControls).indexOf('CHCGYQZDT')) != -1) {
                $("#CHCGYQZDT").removeClass('jq-text-disabled')
                $("#CHCGYQZDT").css({
                    overflow: 'auto',
                })
            }
            if (((paramsObj.AllowEditControls).indexOf('CHCGYQHDT')) != -1) {
                $("#CHCGYQHDT").removeClass('jq-text-disabled')
                $("#CHCGYQHDT").css({
                    overflow: 'auto',
                })
            }
            if (((paramsObj.AllowEditControls).indexOf('GCDCXM')) != -1) {
                $("#GCDCXM").removeClass('jq-text-disabled')
                $("#GCDCXM").css({
                    overflow: 'auto',
                })
            }
            if (((paramsObj.AllowEditControls).indexOf('GCDCYQ')) != -1) {
                $("#GCDCYQ").removeClass('jq-text-disabled')
                $("#GCDCYQ").css({
                    overflow: 'auto',
                })
            }
            if (((paramsObj.AllowEditControls).indexOf('CGTSYQ')) != -1) {
                $("#CGTSYQ").removeClass('jq-text-disabled')
                $("#CGTSYQ").css({
                    overflow: 'auto',
                })
            }
            if (((paramsObj.AllowEditControls).indexOf('EngineeringName')) != -1) {
                $("#EngineeringName").removeClass('jq-text-disabled')
                $("#EngineeringName").css({
                    overflow: 'auto',
                })
            }

            //告诉移动端页面初始完完毕
            if (window.JinQuMobile) {
                window.JinQuMobile.FormEnd();
            }
        }


        /*----------------------------------------------------------------------------------------------*/
        //表单验证交互

        function validateFormBegin() {
            var formVali = $('#IsoGCCLTJDForm').validate({
                //rules: {
                //    Number:'required',//编号
                //    ProjectName: 'required',//项目名称
                //    ColAttVal2:'required',//变更原因
                //    ModifyContent: { //修改内容
                //        required: false,
                //        maxlength: 500
                //    },
                //    FormNote: { // 监理单位意见
                //        required: false,
                //        maxlength: 500
                //    }
                //},
                //messages: {
                //    Number:'请输入编号',
                //    ProjectName: '请输入项目名称 ',
                //    ColAttVal2:'请输入变更原因',
                //    ModifyContent: {
                //        maxlength: '内容长度必须介于0-500之间'
                //    },
                //    FormNote: {
                //        maxlength: '内容长度必须介于0-500之间'
                //    }
                //}
            });

            isValidate = formVali.form();
            if (isValidate) {
                var formData = DomUtil.serialize(document.getElementById('IsoGCCLTJDForm'));//json or =&
                console.log(formData)
                //告诉移动端页面初始完完毕
                //alert(JSON.stringify(formData))
                if (window.JinQuMobile) {
                    window.JinQuMobile.validateFormEnd(JSON.stringify(formData));
                }
            }
        }

        /*----------------------------------------------------------------------------------------------*/
        //不走验证流程
        function noValidateFormBegin() {
            var formData = DomUtil.serialize(document.getElementById('IsoGCCLTJDForm'));//json or =&
            //告诉移动端页面验证完毕
            if (window.JinQuMobile) {
                window.JinQuMobile.validateFormEnd(JSON.stringify(formData));
            }
        }

        //设计人选择
        function SetUseEmpBegin(IdName, n) {
            // 1. 取页面已有人员信息
            var selemp = {
                IdName: IdName,
                ids: $('#' + IdName).val(),
                names: $('#' + IdName + 'Name').val(),
                isSingleSelect: n   //0：单选   1：多选
            }
            // alert(JSON.stringify(selemp))
            if (window.JinQuMobile) {
                window.JinQuMobile.EmpSelectBegin(JSON.stringify(selemp), 'SetSelectInfoEnd');
            }

        }
        //选择人员与部门共用的回调处理
        function SetSelectInfoEnd(emp) {
            //alert(emp)
            emp = JSON.parse(emp);
            var empRows = emp.rows;
            var idName = emp.IdName;
            //alert(idName)
            var dataPushNameValue = [], dataPushIDValue = [];
            for (var i = 0; i < empRows.length; i++) {
                dataPushNameValue.push(empRows[i].names)
                dataPushIDValue.push(empRows[i].ids)
            }
            if (idName == 'EngSJRId') {
                $('#EngSJRId').val(dataPushIDValue);
                $('#EngSJR,#EngSJRIdName').val(dataPushNameValue);
                //$('#EmpDepIDNameText').text(dataPushNameValue);
            }

        }
        function selectCustName() {
            //alert(1)
            $.post('@Url.Action("GetCustomerListComboboxWithCount", "BussCustomer", new { @area= "Bussiness" })' + "?TopCount=10", function (_rData) {
                console.log(JSON.parse(_rData))
                //alert(_rData)
                var appendInfoData = JSON.parse(_rData);
                if (appendInfoData.length > 0) {
                    var interText = doT.template($("#listTpl").text())
                    $("#gridList").html(interText(appendInfoData));
                    $('body').append('<div class="aui-mask"></div>');
                    $(".aui-dialog.aui-hidden").removeClass('aui-hidden');
                }
                else {
                    $.alert('暂无数据');
                    $('#gridList').html('');
                }

            })
        }
        //信息弹出框-----------------------------------------------------------------------
        function cancel() {
            $('div').removeClass("aui-mask")
            $('.aui-dialog').addClass("aui-hidden")
        }
        function confirm() {

            var radioValueLength = $(".radio input[type='radio']:checked").length;
            if (radioValueLength > 0) {
                $('div').removeClass('aui-mask');
                $('.aui-dialog').addClass("aui-hidden");
                var radioValue = $(".radio input[type='radio']:checked").val();
                console.log(radioValue)
                
                //var carId = $(".radio input[type='radio']:checked").attr('id');
                var radioValue = radioValue.split('_');
                console.log(radioValue)
                //alert(radioValue)
                $('#CustID').val(radioValue[0]);
                $('#CustName').val(radioValue[1])
                $('#CustNameText').text(radioValue[1])

            }
            else {
                $.alert('请选择一条数据');
            }
        }

        //项目 - 选择项目
        function SetProjectSelectBegin() {
            var selemp = {
                // 传一个假值
                ProjName: '1'
            }
            if (window.JinQuMobile) {
                window.JinQuMobile.ProjectSelectBegin(JSON.stringify(selemp), 'SetProjectSelectEnd');
            }
        }
        function SetProjectSelectEnd(emp) {
            //alert(emp)
            emp = JSON.parse(emp);
            $('#EngineeringName').val(emp.ProjName);
            $('#EngineeringNumber').val(emp.ProjNumber);
        }
    </script>
}
