#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    #line 4 "..\..\Views\ArchElecFile\list.cshtml"
    using JQ.Web;
    
    #line default
    #line hidden
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/ArchElecFile/list.cshtml")]
    public partial class _Views_ArchElecFile_list_cshtml : System.Web.Mvc.WebViewPage<dynamic>
    {
        public _Views_ArchElecFile_list_cshtml()
        {
        }
        public override void Execute()
        {
            
            #line 1 "..\..\Views\ArchElecFile\list.cshtml"
  
    Layout = "~/Areas/Core/Views/Shared/_Layout.cshtml";

            
            #line default
            #line hidden
WriteLiteral("\r\n");

DefineSection("head", () => {

WriteLiteral("\r\n    <script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(">\r\n        var requestUrl = \'");

            
            #line 7 "..\..\Views\ArchElecFile\list.cshtml"
                     Write(Url.Action("json", "ArchElecFile",new { @area="Archive"}));

            
            #line default
            #line hidden
WriteLiteral("\';\r\n        $(function () {\r\n            JQ.datagrid.datagrid({\r\n                " +
"JQButtonTypes: [\'export\'],//需要显示的按钮\r\n                JQPrimaryID: \'Id\',//主键的字段\r\n" +
"                JQID: \'ElecFileGrid\',//数据表格ID\r\n                JQDialogTitle: \'信" +
"息\',//弹出窗体标题\r\n                JQWidth: \'1024\',//弹出窗体宽\r\n                JQHeight: " +
"\'100%\',//弹出窗体高\r\n                JQLoadingType: \'datagrid\',//数据表格类型 [datagrid,tre" +
"egrid]\r\n                JQFields: [\"Id\", \"ArchProjId\", \"ArchElecFileId\", \"FK_Arc" +
"hElecFile_ArchProjId.ProjectId\"],//追加的字段名\r\n                url: requestUrl,//请求的" +
"地址\r\n                checkOnSelect: true,//是否包含check\r\n                fitColumns:" +
" true,\r\n                nowrap: false,\r\n                JQExcludeCol: [1, 12],\r\n" +
"                toolbar: \'#ElecFilePanel\',//工具栏的容器ID\r\n                columns: [" +
"[\r\n                        { field: \'ck\', align: \'center\', checkbox: true, JQIsE" +
"xclude: true },\r\n                        { title: \'项目编号\', field: \'ElecNumber\', J" +
"Qfield: \'FK_ArchElecFile_ArchProjId.ElecNumber\', width: 100, align: \'center\' },\r" +
"\n\t\t                { title: \'项目名称\', field: \'ElecName\', JQfield: \'FK_ArchElecFile" +
"_ArchProjId.ElecName\', width: 100, align: \'center\' },\r\n\t\t                { title" +
": \'项目经理\', field: \'ProjEmpName\', JQfield: \'FK_ArchElecFile_ArchProjId.ProjEmpName" +
"\', width: 100, align: \'center\' },\r\n\t\t                { title: \'项目阶段\', field: \'Ph" +
"aseName\', JQfield: \'FK_ArchElecFile_ArchProjId.PhaseName\', width: 100, align: \'c" +
"enter\' },\r\n\t\t                { title: \'文件名称\', field: \'ElecFileName\', width: 200," +
" align: \'center\', sortable: true },\r\n                        { title: \'文件类型\', fi" +
"eld: \'ElecExt\', width: 100, align: \'center\', sortable: true },\r\n                " +
"        {\r\n                            title: \"文件大小\", field: \"ElecSize\", width: " +
"\"100\", align: \"right\", halign: \"center\", formatter: function (value, row) {\r\n   " +
"                             row.ElecSize = getFileSizeText(value)\r\n            " +
"                    return row.ElecSize;\r\n                            }\r\n       " +
"                 },\r\n                        //{ title: \'文件大小\', field: \'ElecSize" +
"\', width: 100, align: \'center\', sortable: true },\r\n                        { tit" +
"le: \'电子文件版本\', field: \'ElecFileVersionId\', width: 100, align: \'center\', sortable:" +
" true },\r\n                        { title: \'上传时间\', field: \'CreationTime\', width:" +
" 100, align: \'center\', sortable: true, formatter: JQ.tools.DateTimeFormatterByT " +
"},\r\n                        { title: \'上传人\', field: \'CreatorEmpName\', width: 100," +
" align: \'center\', sortable: true },\r\n                        {\r\n                " +
"            field: \'ProjectId\', title: \'操作\', width: 100, align: \'center\', JQIsEx" +
"clude: true,\r\n                            formatter: function (value, row, index" +
") {\r\n                                return \"<a href=\\\"javascript:Handler(\" + ro" +
"w.ArchProjId + \",\" + row.ProjectId + \",\" + row.ArchElecFileId + \")\\\">打开目录</a>\";\r" +
"\n                            }\r\n                        }\r\n                ]],\r\n" +
"                onRowContextMenu: function (e, index, row) { //右键时触发事件\r\n        " +
"            var $m = $(\'#fileMenu\'),\r\n                        itemState = $m.men" +
"u(\'getItem\', $(\'#setState\')[0]),\r\n                        text = \'加入/移除申请\';\r\n   " +
"                 $.data(document.body, \"selectTempData\", row);//把临时数据存在缓存中\r\n    " +
"                $m.menu(\'setText\', {\r\n                        target: itemState." +
"target,\r\n                        text: text\r\n                    });\r\n          " +
"          $m.menu(\'show\', {\r\n                        left: e.pageX,\r\n           " +
"             top: e.pageY\r\n                    });\r\n                    e.preven" +
"tDefault();\r\n                }\r\n            });\r\n            $(\"#JQElecSearch\")." +
"textbox({\r\n                buttonText: \'筛选\',\r\n                buttonIcon: \'fa fa" +
"-search\',\r\n                height: 25,\r\n                prompt: \'文件名称\',\r\n       " +
"         onClickButton: function () {\r\n                    JQ.datagrid.searchGri" +
"d(\r\n                        {\r\n                            dgID: \'ElecFileGrid\'," +
"\r\n                            loadingType: \'datagrid\',\r\n                        " +
"});\r\n                }\r\n            });\r\n        });\r\n        function getFileSi" +
"zeText(size) {\r\n            if (!size && size != 0) {\r\n                return \"\"" +
";\r\n            }\r\n            var st = \"\";\r\n            if (size >= 1024 * 1024 " +
"* 1024) {\r\n                st = (size / 1024 / 1024 / 1024).toFixed(2) + \"GB\";\r\n" +
"            } else if (size >= 1024 * 1024) {\r\n                st = (size / 1024" +
" / 1024).toFixed(2) + \"MB\";\r\n            } else if (size >= 1024) {\r\n           " +
"     st = (size / 1024).toFixed(2) + \"KB\";\r\n            } else {\r\n              " +
"  st = size + \"B\";\r\n            }\r\n            return st;\r\n        }\r\n        fu" +
"nction downfile() {\r\n            var row = $(\"#ElecFileGrid\").datagrid(\"getSelec" +
"tions\");\r\n            if (row.length <= 0) {\r\n                JQ.dialog.info(\"请选" +
"择\");\r\n                return;\r\n            }\r\n\r\n            var parm;\r\n         " +
"   $.each(row, function (i, n) {\r\n                if (i == 0) {\r\n               " +
"     parm = \"id=\" + n[\"Id\"];\r\n\r\n                } else {\r\n                    pa" +
"rm += \"&id=\" + n[\"Id\"];\r\n                }\r\n            });\r\n            ");

WriteLiteral("\r\n\r\n            var result;\r\n            Url = \'");

            
            #line 116 "..\..\Views\ArchElecFile\list.cshtml"
              Write(Url.Action("IsHavePermissionDown", "ArchElecProject", new { @area = "Archive"}));

            
            #line default
            #line hidden
WriteLiteral(@"';
            $.ajax({

                url: Url,
                data: parm,
                async: false,
                type: ""POST"",
                success: function (result) {
                    //debugger;
                    if (result.stateType == ""0"") {
                        Url = '");

            
            #line 126 "..\..\Views\ArchElecFile\list.cshtml"
                          Write(Url.Action("DownFile", "ArchElecFile", new { @area = "Archive" }));

            
            #line default
            #line hidden
WriteLiteral(@"?';
                        downurlfile(Url + parm);
                        $('#ElecFileGrid').datagrid('reload');

                    }
                    else {
                        JQ.dialog.info(result.validationResults[0].ErrorMessage + ""没有权限下载，需要申请"");
                    }
                }
            });
        }

        function downurlfile(url) {
            var _a = document.createElement(""a"");
            _a.setAttribute(""href"", url);
            document.body.appendChild(_a);
            _a.click();
            document.body.removeChild(_a);
        }


        function Handler(ArchProjId, ProjID, rowid) {
            JQ.dialog.dialog({
                title: ""查看"",
                url: '");

            
            #line 150 "..\..\Views\ArchElecFile\list.cshtml"
                 Write(Url.Action("treelist", "ArchElecProject",new { @area="Archive"}));

            
            #line default
            #line hidden
WriteLiteral(@"' + '?IsRead=1&Id=' + ArchProjId + '&ProjID=' + ProjID + '&rowid=' + rowid,
                width: '1200',
                height: '600',
                JQID: 'ElecFileGrid',
                JQLoadingType: 'datagrid',
                iconCls: 'fa fa-plus'
            });
        }

        var TempData = new Array();
        function menuHandler(item) {
            var data = $.data(document.body, ""selectTempData"");//获取临时数据
            if (JQ.tools.isJson(data)) {
                switch (item.id) {
                    case ""setState"":
                        if ($.inArray(data.Id, TempData) == -1) {
                            TempData.push(data.Id);
                            JQ.dialog.show(""加入申请成功！"");
                        } else {
                            TempData.pop(data.Id);
                            JQ.dialog.show(""移除申请成功！"");
                        };
                        break;
                    case ""view"":
                        if (data.ElecExt == "".pdf"") {
                            JQ.dialog.dialogIframe({
                                title: ""查看"",
                                url: '");

            
            #line 177 "..\..\Views\ArchElecFile\list.cshtml"
                                 Write(Url.Action("pdfView", "ArchElecFile", new { @area="Archive"}));

            
            #line default
            #line hidden
WriteLiteral(@"' + '?Id=' + data.Id,
                                width: '1000',
                                height: '100%',
                                iconCls: 'fa fa-plus'
                            });
                        }
                        else {
                            JQ.dialog.info(""只能预览PDF文件"");
                        }
                        break;
                }
            }
            $.data(document.body, ""selectTempData"", null);//清空临时数据
            return false;
        }

        function apply() {
            var row = $(""#ElecFileGrid"").datagrid(""getSelections"");
            var arr = [];
            if (row.length > 0) {
                $.each(row, function (i, n) {
                    arr.push(n.Id);
                });
            }
            var idArr = Enumerable.From(TempData).Union(arr).Distinct().ToArray();

            if (idArr.length <= 0) {
                JQ.dialog.info(""请选择"");
                return;
            }
            //debugger;
            //alert(idArr.join("",""));
            JQ.dialog.dialog({
                title: ""查看"",
                url: '");

            
            #line 211 "..\..\Views\ArchElecFile\list.cshtml"
                 Write(Url.Action("add", "IsoFormArchive", new { @area= "Iso" }));

            
            #line default
            #line hidden
WriteLiteral(@"' + '?Ids=' + idArr.join("",""),
                width: '800',
                height: '600',
                iconCls: 'fa fa-plus'
            });
        }

        window.refreshGrid = function () {
            $(""#JQElecSearch"").textbox(""button"").click();
        }
    </script>
");

});

WriteLiteral("\r\n");

DefineSection("Body_Content", () => {

WriteLiteral("\r\n    <table");

WriteLiteral(" id=\"ElecFileGrid\"");

WriteLiteral("></table>\r\n    <div");

WriteLiteral(" id=\"ElecFilePanel\"");

WriteLiteral(" JQPanel=\"searchPanel\"");

WriteLiteral(" style=\"padding:5px;height:auto;\"");

WriteLiteral(">\r\n        <span");

WriteLiteral(" JQPanel=\"toolbarPanel\"");

WriteLiteral(">\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-plus\'\"");

WriteLiteral(" onclick=\"apply()\"");

WriteLiteral(">发起申请</a>\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-pencil\'\"");

WriteLiteral(" onclick=\"downfile()\"");

WriteLiteral(" JQPermissionName=\"CanEdit\"");

WriteLiteral(">下载</a>\r\n        </span>\r\n\r\n        <input");

WriteLiteral(" id=\"JQElecSearch\"");

WriteLiteral(" style=\"width:250px;\"");

WriteLiteral(" JQWhereOptions=\"{ \'Key\': \'ElecFileName\', \'Contract\': \'like\' }\"");

WriteLiteral(" />\r\n\r\n    </div>\r\n\r\n    <div");

WriteLiteral(" id=\"fileMenu\"");

WriteLiteral(" class=\"easyui-menu\"");

WriteLiteral(" data-options=\"onClick:menuHandler\"");

WriteLiteral(" style=\"width:100px;display: none;\"");

WriteLiteral(">\r\n        <div");

WriteLiteral(" id=\"setState\"");

WriteLiteral("></div>\r\n        <div");

WriteLiteral(" id=\"view\"");

WriteLiteral(">预览文件</div>\r\n    </div>\r\n    <input");

WriteLiteral(" type=\"hidden\"");

WriteLiteral(" id=\"ExportType\"");

WriteLiteral(" name=\"ExportType\"");

WriteLiteral(" value=\"1\"");

WriteLiteral(" />\r\n");

});

WriteLiteral("\r\n");

        }
    }
}
#pragma warning restore 1591
