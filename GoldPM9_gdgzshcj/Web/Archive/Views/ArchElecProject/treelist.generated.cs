#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    
    #line 1 "..\..\Views\ArchElecProject\treelist.cshtml"
    using JQ.Web;
    
    #line default
    #line hidden
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/ArchElecProject/treelist.cshtml")]
    public partial class _Views_ArchElecProject_treelist_cshtml : System.Web.Mvc.WebViewPage<dynamic>
    {
        public _Views_ArchElecProject_treelist_cshtml()
        {
        }
        public override void Execute()
        {
WriteLiteral("<script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(">\r\n\r\n    $(function () {\r\n\r\n        ////验证是否有下载权限\r\n        //var alldown = \"");

            
            #line 7 "..\..\Views\ArchElecProject\treelist.cshtml"
                    Write(ViewBag.allDown);

            
            #line default
            #line hidden
WriteLiteral("\";\r\n\r\n        //if(alldown==\"0\")\r\n        //{\r\n        //    $(\"#httpDown\").hide(" +
");\r\n        //}\r\n    });\r\n\r\n\r\n    $(\'#lefttree\').treegrid({\r\n        url: \'");

            
            #line 17 "..\..\Views\ArchElecProject\treelist.cshtml"
         Write(Url.Action("treejson", "ArchElecProject", new { @area= "Archive", ProjID = ViewBag.ProjID }));

            
            #line default
            #line hidden
WriteLiteral(@"',
        idField: 'id',
        treeField: 'text',
        border: 0,
        toolbar: '#tbleft',
        fit: true,
        animate: true,
        singleSelect: true,
        columns: [[
           { title: '<b>选择节点</b>', field: 'text', width: 240, align: 'left' }
        ]],
        onLoadSuccess: function (row, data) {
        },
        onSelect: function (node) {
            $(""#AttID"").val(node.id);
            //alert($(""#AttID"").val());
            $('#ArchElecFileGrid').datagrid('load', {
                refid: node.id
            });
        }
    });
    JQ.datagrid.datagrid({
        JQPrimaryID: 'Id',//主键的字段
        JQID: 'ArchElecFileGrid',//数据表格ID
        JQDialogTitle: '信息',//弹出窗体标题
        JQWidth: '768',//弹出窗体宽
        JQHeight: '100%',//弹出窗体高
        JQLoadingType: 'datagrid',//数据表格类型 [datagrid,treegrid]
        JQFields: [""Id"", ""ElecFileType"", ""ElecFileVersionId""],//追加的字段名
        url: '");

            
            #line 46 "..\..\Views\ArchElecProject\treelist.cshtml"
         Write(Url.Action("dirjson", "ArchElecFile",new { @area="Archive", refid = ViewBag.ArchElecFileId }));

            
            #line default
            #line hidden
WriteLiteral("\',//请求的地址\r\n        checkOnSelect: true,//是否包含check\r\n        fitColumns: true,\r\n  " +
"      nowrap: false,\r\n        toolbar: \'#ArchElecFilePanel\',//工具栏的容器ID\r\n        " +
"columns: [[\r\n                { field: \'ck\', align: \'center\', checkbox: true, JQI" +
"sExclude: true },\r\n                { title: \'文件名称\', field: \'ElecFileName\', width" +
": 200, align: \'center\', sortable: true },\r\n                { title: \'文件类型\', fiel" +
"d: \'ElecExt\', width: 100, align: \'center\', sortable: true },\r\n                {\r" +
"\n                    title: \"文件大小\", field: \"ElecSize\", width: \"10%\", align: \"rig" +
"ht\", halign: \"center\", formatter: function (value, row) {\r\n                     " +
"   row.ElecSize = getFileSizeText(value)\r\n                        return row.Ele" +
"cSize;\r\n                    }\r\n                },\r\n                { title: \'电子文" +
"件版本\', field: \'ElecFileVersionId\', width: 100, align: \'center\', sortable: true }," +
"\r\n                { title: \'上传时间\', field: \'CreationTime\', width: 100, align: \'ce" +
"nter\', sortable: true, formatter: JQ.tools.DateTimeFormatterByT },\r\n            " +
"    { title: \'上传人\', field: \'CreatorEmpName\', width: 100, align: \'center\', sortab" +
"le: true },\r\n        ]]\r\n    });\r\n    $(\"#fullNameSearch\").textbox({\r\n        bu" +
"ttonText: \'筛选\',\r\n        buttonIcon: \'fa fa-search\',\r\n        height: 25,\r\n     " +
"   prompt: \'文件名称\',\r\n        onClickButton: function () {\r\n            JQ.datagri" +
"d.searchGrid(\r\n                {\r\n                    dgID: \'ArchElecFileGrid\',\r" +
"\n                    loadingType: \'datagrid\',\r\n                    queryParams: " +
"{\r\n                        refid: $(\"#AttID\").val()\r\n                    }\r\n    " +
"            });\r\n        }\r\n    });\r\n    function save(flag) {\r\n        var id =" +
" $(\"#lefttree\").treegrid(\"getSelected\").id;\r\n        if (isNaN(id)) {\r\n         " +
"   JQ.dialog.info(\"请选择\");\r\n            return;\r\n        }\r\n        var Url = \'\';" +
"\r\n        if (flag == 1) {\r\n            Url = \'");

            
            #line 90 "..\..\Views\ArchElecProject\treelist.cshtml"
              Write(Url.Action("add", "ArchElecProject", new {@area="Archive" }));

            
            #line default
            #line hidden
WriteLiteral("\';\r\n            JQ.dialog.dialog({\r\n                title: \"目录\",\r\n               " +
" url: Url + \'?ParentId=\' + id + \'&ProjectId=\' + \'");

            
            #line 93 "..\..\Views\ArchElecProject\treelist.cshtml"
                                                           Write(ViewBag.ProjID);

            
            #line default
            #line hidden
WriteLiteral(@"',
                width: '600',
                height: '400',
                JQID: 'lefttree',
                JQLoadingType: 'treegrid',
                iconCls: 'fa fa-plus'
            });
        }
        else if (flag == 2) {
            Url = '");

            
            #line 102 "..\..\Views\ArchElecProject\treelist.cshtml"
              Write(Url.Action("edit", "ArchElecProject", new {@area="Archive" }));

            
            #line default
            #line hidden
WriteLiteral("\';\r\n            JQ.dialog.dialog({\r\n                title: \"目录\",\r\n               " +
" url: Url + \'?Id=\' + id + \'&ProjectId=\' + \'");

            
            #line 105 "..\..\Views\ArchElecProject\treelist.cshtml"
                                                     Write(ViewBag.ProjID);

            
            #line default
            #line hidden
WriteLiteral("\',\r\n                width: \'600\',\r\n                height: \'400\',\r\n              " +
"  JQID: \'lefttree\',\r\n                JQLoadingType: \'treegrid\',\r\n               " +
" iconCls: \'fa fa-plus\'\r\n            });\r\n        }\r\n        else {\r\n            " +
"Url = \'");

            
            #line 114 "..\..\Views\ArchElecProject\treelist.cshtml"
              Write(Url.Action("del", "ArchElecProject", new { @area = "Archive", }));

            
            #line default
            #line hidden
WriteLiteral(@"';
            JQ.tools.ajax({
                doBackResult: true,
                url: Url,
                data: 'Id=' + id
            });
            $('#lefttree').treegrid('reload');
            return;
        }
    }


    function del() {
        var row = $(""#ArchElecFileGrid"").datagrid(""getSelections"");
        if (row.length <= 0) {
            JQ.dialog.info(""请选择"");
            return;
        }

        var parm;
        $.each(row, function (i, n) {
            if (i == 0) {
                parm = ""id="" + n[""Id""];

            } else {
                parm += ""&id="" + n[""Id""];
            }
        });

        Url = '");

            
            #line 143 "..\..\Views\ArchElecProject\treelist.cshtml"
          Write(Url.Action("del", "ArchElecFile", new { @area = "Archive"}));

            
            #line default
            #line hidden
WriteLiteral(@"';
        JQ.tools.ajax({
            doBackResult: true,
            url: Url,
            data: parm
        });
        $('#ArchElecFileGrid').datagrid('reload');
    }

   

    function downurl(url) {
        var _a = document.createElement(""a"");
        _a.setAttribute(""href"", url);
        document.body.appendChild(_a);
        _a.click();
        document.body.removeChild(_a);
    }

    function down() {
        var row = $(""#ArchElecFileGrid"").datagrid(""getSelections"");
        if (row.length <= 0) {
            JQ.dialog.info(""请选择"");
            return;
        }

        var parm;
        $.each(row, function (i, n) {
            if (i == 0) {
                parm = ""id="" + n[""Id""];

            } else {
                parm += ""&id="" + n[""Id""];
            }
        });
       //验证用户是否有权限下载数据
        var result;
        Url = '");

            
            #line 180 "..\..\Views\ArchElecProject\treelist.cshtml"
          Write(Url.Action("IsHavePermissionDown", "ArchElecProject", new { @area = "Archive"}));

            
            #line default
            #line hidden
WriteLiteral(@"';
        $.ajax({

            url: Url,
            data: parm,
            async: false,
            type: ""POST"",
            success: function (result) {
                //debugger;
                if (result.stateType == ""0"") {
                    Url = '");

            
            #line 190 "..\..\Views\ArchElecProject\treelist.cshtml"
                      Write(Url.Action("DownFile", "ArchElecFile", new { @area = "Archive" }));

            
            #line default
            #line hidden
WriteLiteral(@"?';
                    downurl(Url + parm);
                    $('#ArchElecFileGrid').datagrid('reload');

                }
                else {
                    JQ.dialog.info(result.validationResults[0].ErrorMessage + ""没有权限下载，需要申请"");
                }
            }
        });

          
       

    }

    //验证是否有权限下载
    function IsHavePermissionDown(parm) {
       
        var result;
        Url = '");

            
            #line 210 "..\..\Views\ArchElecProject\treelist.cshtml"
          Write(Url.Action("IsHavePermissionDown", "ArchElecProject", new { @area = "Archive"}));

            
            #line default
            #line hidden
WriteLiteral(@"';
        $.ajax({
            
            url: Url,
            data: parm,
            async: false,
            type: ""POST"",
            success: function (result) {
                debugger;
                if (result.Result == false) {
                    JQ.dialog.error(result.Message);
                    return result;
                }
            }
        });


       
    }


    $(""#httpUpload"").click(function () {

        var id = $(""#lefttree"").treegrid(""getSelected"").id;
        if (isNaN(id)) {
            JQ.dialog.info(""请选择"");
            return;
        }

        var divid = getMathNo();
        if (window.top.$(""#"" + divid).size() <= 0) {
            window.top.$(""body"").append(""<div class='rwpdialogdiv' id='"" + divid + ""'></div>"");
        }
        var paraJosn = {
            iconCls: 'fa fa-upload',
            title: ""<b>文件上传</b>"",
            content: '<iframe id=""uploadIframe"" frameborder=""0"" scrolling=""no"" style=""width:100%;height:99%"" src=""");

            
            #line 246 "..\..\Views\ArchElecProject\treelist.cshtml"
                                                                                                             Write(Url.Action("uploadByHttp", "usercontrol", new { @area = "Core", }));

            
            #line default
            #line hidden
WriteLiteral(@"?AttachRefID=0&AttachRefTable=ElecFile""></iframe>',
            width: '608',
            height: '353',
            resizable: false,
            maximizable: false,
            collapsible: false,
            modal: true,
            onClose: function () {
                Url = '");

            
            #line 254 "..\..\Views\ArchElecProject\treelist.cshtml"
                  Write(Url.Action("save", "ArchElecFile", new { @area = "Archive", }));

            
            #line default
            #line hidden
WriteLiteral("\';\r\n                JQ.tools.ajax({\r\n                    doBackResult: true,\r\n   " +
"                 url: Url,\r\n                    data: \'ProjID=");

            
            #line 258 "..\..\Views\ArchElecProject\treelist.cshtml"
                             Write(ViewBag.ArchProjID);

            
            #line default
            #line hidden
WriteLiteral(@"&Id=' + id
                });
                $('#ArchElecFileGrid').datagrid('reload');
                window.top.$(""#"" + divid).parent().remove();
            }
        };
        var dialog = window.top.$(""#"" + divid).dialog(paraJosn);
    });

    function getMathNo() {
        var d = new Date();
        var sp = """";
        var month = d.getMonth() + 1;
        var strDate = d.getDate();
        if (month >= 1 && month <= 9) {
            month = ""0"" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = ""0"" + strDate;
        }
        var math = Math.floor(Math.random() * (1000000 + 1));
        var cd = d.getHours() + sp + d.getMinutes() + sp + d.getSeconds() + sp + d.getMilliseconds();
        return math + sp + cd;
    };

    function applyTree() {
        var row = $(""#ArchElecFileGrid"").datagrid(""getSelections"");
        var arr = [];
        if (row.length > 0) {
            $.each(row, function (i, n) {
                arr.push(n.Id);
            });
        }
        if (arr.length <= 0) {
            JQ.dialog.info(""请选择"");
            return;
        }
        JQ.dialog.dialog({
            title: ""查看"",
            url: '");

            
            #line 297 "..\..\Views\ArchElecProject\treelist.cshtml"
             Write(Url.Action("add", "IsoFormArchive", new { @area= "Iso" }));

            
            #line default
            #line hidden
WriteLiteral(@"' + '?Ids=' + arr.join("",""),
            width: '800',
            height: '600',
            iconCls: 'fa fa-plus'
        });
    }

    function showSign() {
        var row = $(""#ArchElecFileGrid"").datagrid(""getSelections"");
        var arr = [];
        if (row.length > 0) {
            $.each(row, function (i, n) {
                arr.push(n);
            });
        }
        if (arr.length <= 0) {
            JQ.dialog.info(""请选择"");
            return;
        }

        var data = arr[0];
        debugger;
        JQ.dialog.dialog({
            title: ""查看"",
            url: '");

            
            #line 321 "..\..\Views\ArchElecProject\treelist.cshtml"
             Write(Url.Action("TaskAttachSplitFilesList", "DesTask", new { @area = "Design" }));

            
            #line default
            #line hidden
WriteLiteral(@"?AttachID=' + data.ElecFileType + '&AttachVer=' + data.ElecFileVersionId,
            width: '800',
            height: '600',
            iconCls: 'fa fa-plus'
        });
    }

    function getFileSizeText(size) {
        if (!size && size != 0) {
            return """";
        }
        var st = """";
        if (size >= 1024 * 1024 * 1024) {
            st = (size / 1024 / 1024 / 1024).toFixed(2) + ""GB"";
        } else if (size >= 1024 * 1024) {
            st = (size / 1024 / 1024).toFixed(2) + ""MB"";
        } else if (size >= 1024) {
            st = (size / 1024).toFixed(2) + ""KB"";
        } else {
            st = size + ""B"";
        }
        return st;
    }

    window.refreshGrid = function () {
        $(""#JQSearch"").textbox(""button"").click();
    }
</script>
");

            
            #line 349 "..\..\Views\ArchElecProject\treelist.cshtml"
Write(RenderPage("~/Areas/Core/Views/Shared/_Init.cshtml"));

            
            #line default
            #line hidden
WriteLiteral("\r\n<div");

WriteLiteral(" id=\"treePanel\"");

WriteLiteral(" class=\"easyui-layout\"");

WriteLiteral(" style=\"overflow: hidden\"");

WriteLiteral(" fit=\"true\"");

WriteLiteral(">\r\n    <div");

WriteLiteral(" data-options=\"region:\'west\',split:false\"");

WriteLiteral(" style=\"width:250px;\"");

WriteLiteral(">\r\n        <table");

WriteLiteral(" id=\"lefttree\"");

WriteLiteral("></table>\r\n    </div>\r\n    <div");

WriteLiteral(" data-options=\"region:\'center\'\"");

WriteLiteral(" style=\"background:#eee;\"");

WriteLiteral(">\r\n        <table");

WriteLiteral(" id=\"ArchElecFileGrid\"");

WriteLiteral("> </table>\r\n    </div>\r\n    <div");

WriteLiteral(" id=\"tbleft\"");

WriteLiteral(" style=\"padding:5px;\"");

WriteLiteral(">\r\n        <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-plus\'\"");

WriteLiteral(" onclick=\"save(1)\"");

WriteLiteral(" JQPermissionName=\"CanEdit\"");

WriteLiteral(">新增</a>\r\n        <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-pencil\'\"");

WriteLiteral(" onclick=\"save(2)\"");

WriteLiteral(" JQPermissionName=\"CanEdit\"");

WriteLiteral(">修改</a>\r\n        <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-trash\'\"");

WriteLiteral(" onclick=\"save(3)\"");

WriteLiteral(" JQPermissionName=\"CanEdit\"");

WriteLiteral(">删除</a>\r\n    </div>\r\n    <div");

WriteLiteral(" id=\"ArchElecFilePanel\"");

WriteLiteral(" style=\"padding:5px;height:auto;\"");

WriteLiteral(">\r\n        <span");

WriteLiteral(" JQPanel=\"toolbarPanel\"");

WriteLiteral(">\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-plus\'\"");

WriteLiteral(" onclick=\"applyTree()\"");

WriteLiteral(">发起申请</a>\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-plus\'\"");

WriteLiteral(" id=\"httpUpload\"");

WriteLiteral(" JQPermissionName=\"CanEdit\"");

WriteLiteral(">上传</a>\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-pencil\'\"");

WriteLiteral(" id=\"httpDown\"");

WriteLiteral("  onclick=\"down()\"");

WriteLiteral("   >下载</a>\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-trash\'\"");

WriteLiteral(" onclick=\"del()\"");

WriteLiteral("  JQPermissionName=\"CanEdit\"");

WriteLiteral(">删除</a>\r\n            <a");

WriteLiteral(" class=\"easyui-linkbutton\"");

WriteLiteral(" data-options=\"plain:true,iconCls:\'fa fa-share-square-o\'\"");

WriteLiteral(" onclick=\"showSign()\"");

WriteLiteral(">查看签名</a>\r\n        </span>\r\n        <input");

WriteLiteral(" id=\"startTime\"");

WriteLiteral(" type=\"text\"");

WriteLiteral(" class=\"easyui-datebox\"");

WriteLiteral(" style=\"width:110px\"");

WriteLiteral(" data-options=\"prompt: \'开始日期\'\"");

WriteLiteral(" JQWhereOptions=\"{ Key:\'LastModificationTime\', Contract:\'>=\',filedType:\'Date\' }\"");

WriteLiteral(">\r\n        至\r\n        <input");

WriteLiteral(" id=\"endTime\"");

WriteLiteral(" type=\"text\"");

WriteLiteral(" class=\"easyui-datebox\"");

WriteLiteral(" style=\"width:110px\"");

WriteLiteral(" data-options=\"prompt: \'结束日期\'\"");

WriteLiteral(" JQWhereOptions=\"{ Key:\'LastModificationTime\', Contract:\'<=\',filedType:\'Date\' }\"");

WriteLiteral(">&nbsp;\r\n        <input");

WriteLiteral(" id=\"fullNameSearch\"");

WriteLiteral(" value=\"\"");

WriteLiteral(" style=\"width:250px;\"");

WriteLiteral(" JQWhereOptions=\"{ Key: \'ElecFileName\', \'Contract\': \'like\' }\"");

WriteLiteral(" />\r\n        <input");

WriteLiteral(" type=\"hidden\"");

WriteLiteral(" value=\"0\"");

WriteLiteral(" id=\"AttID\"");

WriteLiteral(" JQWhereOptions=\"{ Key: \'ArchElecFileId\', \'Contract\': \'=\',filedType:\'Int\' }\"");

WriteLiteral(" />\r\n    </div>\r\n</div>\r\n");

        }
    }
}
#pragma warning restore 1591
